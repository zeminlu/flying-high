<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>flying-high: src/ttys.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>src/ttys.c</h1><a href="ttys_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="ttys_8h.html" title="The tty header file.">ttys.h</a>&quot;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="ttys_8c.html#abc1a66fd7ebd48bdcd5883769740c225">00012</a> <span class="keyword">typedef</span> void (*<a class="code" href="ttys_8c.html#abc1a66fd7ebd48bdcd5883769740c225">videoParser</a>)( void );
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="ttys_8c.html#a66d44f0f200f3be2f975a30a9be6e030">00014</a> <span class="keyword">typedef</span> void (*<a class="code" href="ttys_8c.html#a66d44f0f200f3be2f975a30a9be6e030">printFunctions</a>)( int, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a>);
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="ttys_8c.html#ab8884bb7c4606d4ff6aa02da4862e02b">videoBuffer</a>[<a class="code" href="config_8h.html#a6f784c53fe46a1d7cc4979a97ce2b484" title="Real screen size with color attributes.">VIDEO_MEMORY_SIZE</a>];
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="keyword">extern</span> <a class="code" href="structprocess__t.html" title="The process struct.">process_t</a> <a class="code" href="bin_8c.html#a83e1a7341d63e92cd3d1733f87176a88">processTable</a>[<a class="code" href="config_8h.html#ad4c770f8a29f82d705f3d34839112bd1" title="The maximum amount of process.">MAX_PROCESS</a>];
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="keyword">extern</span> <a class="code" href="structprocess__t.html" title="The process struct.">process_t</a> *<a class="code" href="stdio_8h.html#ab7f4e33be6189512770d5aaa43bd03fe">runningProcess</a>;
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="keyword">extern</span> <a class="code" href="structprocess__t.html" title="The process struct.">process_t</a> *<a class="code" href="process_8c.html#a8f3d19e4d5dfc217f2a8bd0492856f32">initProcess</a>;
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">extern</span> <a class="code" href="types_8h.html#a90ed3c9028a7fa45665d10b5210fa142" title="Keycode typedef.">Keycode</a> *<a class="code" href="keyboard__driver_8c.html#a1450b40f662a6e83afdd2146c0a64307">keyboardBuffer</a>;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">static</span> <a class="code" href="structsys_t_t_y.html" title="The tty system struct.">sysTTY</a> ttyTable;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">static</span> <a class="code" href="structtty__s.html" title="The tty_s struct.">tty_s</a> TTYsList[<a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>];
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="keyword">static</span> <a class="code" href="structstd_in_t_t_y.html" title="The tty stdin struct.">stdInTTY</a> TTYstdIns[<a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>];
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">static</span> <a class="code" href="structstd_out_t_t_y.html" title="The tty stdout struct.">stdOutTTY</a> TTYstdOuts[<a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>];
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">static</span> <a class="code" href="types_8h.html#a90ed3c9028a7fa45665d10b5210fa142" title="Keycode typedef.">Keycode</a> stdInBuffers[<a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>][<a class="code" href="config_8h.html#a842ed03f27719bc87666bfd1f75415b8" title="The length of the shell buffer.">MAX_LINE</a>];
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">static</span> <a class="code" href="types_8h.html#a90ed3c9028a7fa45665d10b5210fa142" title="Keycode typedef.">Keycode</a> stdOutBuffers[<a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>][<a class="code" href="config_8h.html#a6cacb150853456c97c51481e67d0dabc" title="Real screen size without color attribute.">SCREEN_SIZE</a>];
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> kbOffset[<a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>];
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="keyword">static</span> <a class="code" href="ttys_8c.html#abc1a66fd7ebd48bdcd5883769740c225">videoParser</a> videoParserFunctions[] = {
<a name="l00041"></a>00041         <a class="code" href="video__driver_8h.html#a4d97d68f78f46ab5113601223fa2583a" title="Brief.">printAlarm</a>,
<a name="l00042"></a>00042         <a class="code" href="video__driver_8h.html#acbe81cee62ff6277f842beb233a30ba2" title="Brief.">printBackspace</a>,
<a name="l00043"></a>00043         <a class="code" href="video__driver_8h.html#a20a86692404759575f617bfa07cf0e20" title="Brief.">printTab</a>,
<a name="l00044"></a>00044         <a class="code" href="video__driver_8h.html#a33969be99f454fe7ad78c027d47c9053" title="Brief.">printNewLine</a>,
<a name="l00045"></a>00045         <a class="code" href="video__driver_8h.html#ab6c84a2c68bc7176a73f7312b76775a8" title="Brief.">printVTab</a>,
<a name="l00046"></a>00046         <a class="code" href="video__driver_8h.html#a87a84573dc8e6aa7520e2840bde5dbf8" title="Brief.">printLineFeed</a>,
<a name="l00047"></a>00047         <a class="code" href="video__driver_8h.html#a1ba23d1cbd358745c50fa2bf28a8c019" title="Brief.">printReturn</a>
<a name="l00048"></a>00048 };
<a name="l00049"></a>00049 <span class="comment">/* Initialize the structures of each TTYs */</span>
<a name="l00050"></a><a class="code" href="ttys_8c.html#a9ee58440374f467ffe3fa7100485272c">00050</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#a9ee58440374f467ffe3fa7100485272c" title="Create the table of ttys. The maximum of ttys is a define.">initializeTTY</a>( <span class="keywordtype">void</span> )
<a name="l00051"></a>00051 {
<a name="l00052"></a>00052         <span class="keywordtype">int</span> i;
<a name="l00053"></a>00053         
<a name="l00054"></a>00054         ttyTable.<a class="code" href="structsys_t_t_y.html#a0bc680aada6c6392e4613573f212438b">qtyTTY</a> = <a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>;
<a name="l00055"></a>00055         ttyTable.<a class="code" href="structsys_t_t_y.html#ad4f84dd55c369a7bd7d9f562fc76662f">focusTTY</a> = <a class="code" href="config_8h.html#ad16585962eaf6f3a114a237350a9ba97">STD_TTY</a>;
<a name="l00056"></a>00056         <span class="keywordflow">for</span>( i = 0 ; i &lt; <a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a> ; ++i ){
<a name="l00057"></a>00057                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i] = &amp;(TTYsList[i]);
<a name="l00058"></a>00058                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a7bdcbca143d0773edef7d01762d42aff">ttyId</a> = i;
<a name="l00059"></a>00059                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a> = &amp;(TTYstdIns[i]);
<a name="l00060"></a>00060                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a>-&gt;<a class="code" href="structstd_in_t_t_y.html#adbc1696a6e5a5d97b6761336fc185945">stdInBuffer</a> = stdInBuffers[i];
<a name="l00061"></a>00061                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a>-&gt;<a class="code" href="structstd_in_t_t_y.html#ada738b143166d2de18a92ff55801f41b">writeOffset</a> = 0;
<a name="l00062"></a>00062                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a> = &amp;(TTYstdOuts[i]);
<a name="l00063"></a>00063                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a> = stdOutBuffers[i];
<a name="l00064"></a>00064                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a5be2ba5c5e17899443300974060fe13f">hasScrolled</a> = 0;
<a name="l00065"></a>00065                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#afefb5a7d2161ce434bcc2bbb358d5b0b">focusProcess</a>  = 0;
<a name="l00066"></a>00066                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a> = 0;
<a name="l00067"></a>00067                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a> = <a class="code" href="config_8h.html#a96df1fa5a1eb0452e87bad701a632eeb" title="The starter column position.">CURSOR_START_COL</a>;
<a name="l00068"></a>00068                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a> = <a class="code" href="config_8h.html#a0918341b64efcf251a70fc2c188803fa" title="The starter row position.">CURSOR_START_ROW</a>;
<a name="l00069"></a>00069                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a> = 0;
<a name="l00070"></a>00070                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> = <a class="code" href="config_8h.html#a96df1fa5a1eb0452e87bad701a632eeb" title="The starter column position.">CURSOR_START_COL</a>;
<a name="l00071"></a>00071                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[i]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a> = <a class="code" href="config_8h.html#a0918341b64efcf251a70fc2c188803fa" title="The starter row position.">CURSOR_START_ROW</a>;
<a name="l00072"></a>00072                 kbOffset[i] = 0;
<a name="l00073"></a>00073         }
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">/*</span>
<a name="l00077"></a>00077 <span class="comment">*       Static functions for putcharTTY</span>
<a name="l00078"></a>00078 <span class="comment">*/</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="comment">/* Obtain the read pointer of the specific TTY */</span>
<a name="l00081"></a><a class="code" href="ttys_8c.html#a5cab16b9bb408c134bba477fa1436919">00081</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#a5cab16b9bb408c134bba477fa1436919" title="This function obtains read pointers of the tty.">getReadPointer</a>(<a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty, <span class="keywordtype">int</span> *readPointer, <span class="keywordtype">int</span> *readCol, <span class="keywordtype">int</span> *readRow){
<a name="l00082"></a>00082         *readPointer = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a>;
<a name="l00083"></a>00083         *readCol = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a>;
<a name="l00084"></a>00084         *readRow = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a>;
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">/* Obtain the write Pointer of the specific TTY */</span>
<a name="l00088"></a><a class="code" href="ttys_8c.html#a5c29772760b26cdfca93bc1284b60732">00088</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#a5c29772760b26cdfca93bc1284b60732" title="This function obtains writer pointers of the tty.">getWritePointer</a>(<a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty, <span class="keywordtype">int</span> *writePointer, <span class="keywordtype">int</span> *writeCol, <span class="keywordtype">int</span> *writeRow){
<a name="l00089"></a>00089         *writePointer = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>;
<a name="l00090"></a>00090         *writeCol = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>;
<a name="l00091"></a>00091         *writeRow = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>;
<a name="l00092"></a>00092         
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">/* Backup the reads variables of the tty */</span>
<a name="l00096"></a><a class="code" href="ttys_8c.html#ae286c1ea11787c6fcf410fb0474c2626">00096</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#ae286c1ea11787c6fcf410fb0474c2626" title="This function saves the reads pointers of the tty that is indicated in the signature...">setReadPointer</a>(<a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty, <span class="keywordtype">int</span> readPointer, <span class="keywordtype">int</span> readCol, <span class="keywordtype">int</span> readRow){
<a name="l00097"></a>00097         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a> = readPointer;
<a name="l00098"></a>00098         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> = readCol;
<a name="l00099"></a>00099         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a> = readRow;
<a name="l00100"></a>00100         
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="comment">/* Backup the writers variables of the tty */</span>
<a name="l00104"></a><a class="code" href="ttys_8c.html#af5041dd94c379cc8189ec93b816c3a20">00104</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#af5041dd94c379cc8189ec93b816c3a20" title="This function saves the reads pointers of the tty that is indicated in the signature...">setWritePointer</a>(<a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty, <span class="keywordtype">int</span> writePointer, <span class="keywordtype">int</span> writeCol, <span class="keywordtype">int</span> writeRow){
<a name="l00105"></a>00105         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a> = writePointer;
<a name="l00106"></a>00106         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a> = writeCol;
<a name="l00107"></a>00107         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a> = writeRow;     
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">/* increment the read pointers */</span>
<a name="l00111"></a>00111 <span class="keyword">static</span> <span class="keywordtype">void</span> incReadPointer ( <span class="keywordtype">int</span> *readPointer, <span class="keywordtype">int</span> *readCol, <span class="keywordtype">int</span> *readRow )
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113         (*readPointer)++;
<a name="l00114"></a>00114         ++(*readCol);
<a name="l00115"></a>00115         <span class="keywordflow">if</span> ( (*readCol) == <a class="code" href="config_8h.html#a2cd109632a6dcccaa80b43561b1ab700" title="The width of the screen.">SCREEN_WIDTH</a> )
<a name="l00116"></a>00116         {
<a name="l00117"></a>00117                 (*readCol) = 0;
<a name="l00118"></a>00118                 ++(*readRow);
<a name="l00119"></a>00119         }
<a name="l00120"></a>00120         <span class="keywordflow">if</span> ( (*readRow) == <a class="code" href="config_8h.html#a25f7ae536603397e929ff4941e253200" title="The height of the screen.">SCREEN_HEIGTH</a> )
<a name="l00121"></a>00121                 (*readRow) = 0;
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="comment">/* decrement the read pointers */</span>
<a name="l00125"></a>00125 <span class="keyword">static</span> <span class="keywordtype">void</span> decReadPointer ( <span class="keywordtype">int</span> *readPointer, <span class="keywordtype">int</span> *readCol, <span class="keywordtype">int</span> *readRow )
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127         <span class="keywordflow">if</span> ( ((*readPointer)--) &lt; 0 )
<a name="l00128"></a>00128                 (*readPointer) = 0;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         --(*readCol);
<a name="l00131"></a>00131         <span class="keywordflow">if</span> ( (*readCol) == -1 )
<a name="l00132"></a>00132         {
<a name="l00133"></a>00133                 (*readCol) = <a class="code" href="config_8h.html#a2cd109632a6dcccaa80b43561b1ab700" title="The width of the screen.">SCREEN_WIDTH</a> - 1;
<a name="l00134"></a>00134                 --(*readRow);
<a name="l00135"></a>00135         }
<a name="l00136"></a>00136         <span class="keywordflow">if</span> ( (*readRow) == -1 )
<a name="l00137"></a>00137         {
<a name="l00138"></a>00138                 (*readRow) = 0;
<a name="l00139"></a>00139                 (*readCol) = 0;
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">/* increment the write pointers */</span>
<a name="l00144"></a>00144 <span class="keyword">static</span> <span class="keywordtype">void</span> incWritePointer ( <span class="keywordtype">int</span> *writePointer, <span class="keywordtype">int</span> *writeCol, <span class="keywordtype">int</span> *writeRow )
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146         (*writePointer)++;
<a name="l00147"></a>00147         ++(*writeCol);
<a name="l00148"></a>00148         <span class="keywordflow">if</span> ( (*writeCol) == <a class="code" href="config_8h.html#a2cd109632a6dcccaa80b43561b1ab700" title="The width of the screen.">SCREEN_WIDTH</a> )
<a name="l00149"></a>00149         {
<a name="l00150"></a>00150                 (*writeCol) = 0;
<a name="l00151"></a>00151                 ++(*writeRow);
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153         <span class="keywordflow">if</span> ( (*writeRow) == <a class="code" href="config_8h.html#a25f7ae536603397e929ff4941e253200" title="The height of the screen.">SCREEN_HEIGTH</a> )
<a name="l00154"></a>00154                 (*writeRow) = 0;
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="comment">/* decrement the read pointers */</span>
<a name="l00158"></a>00158 <span class="keyword">static</span> <span class="keywordtype">void</span> decWritePointer ( <span class="keywordtype">int</span> *writePointer, <span class="keywordtype">int</span> *writeCol, <span class="keywordtype">int</span> *writeRow )
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160         <span class="keywordflow">if</span> ( ( (*writePointer)--) &lt; 0 )
<a name="l00161"></a>00161                 (*writePointer) = 0;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         --(*writeCol);
<a name="l00164"></a>00164         <span class="keywordflow">if</span> ( (*writeCol) == -1 )
<a name="l00165"></a>00165         {
<a name="l00166"></a>00166                 (*writeCol) = <a class="code" href="config_8h.html#a2cd109632a6dcccaa80b43561b1ab700" title="The width of the screen.">SCREEN_WIDTH</a> - 1;
<a name="l00167"></a>00167                 --(*writeRow);
<a name="l00168"></a>00168         }
<a name="l00169"></a>00169         <span class="keywordflow">if</span> ( (*writeRow) == -1 )
<a name="l00170"></a>00170         {
<a name="l00171"></a>00171                 (*writeRow) = 0;
<a name="l00172"></a>00172                 (*writeCol) = 0;
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="comment">/* return the FILE * of the specific tty */</span>
<a name="l00177"></a>00177 <span class="keyword">static</span> <a class="code" href="struct_f_i_l_e.html" title="The FILE struct.">FILE</a> * sysGetTTYFocusedProcessStream(<a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty, <span class="keywordtype">int</span> fd){
<a name="l00178"></a>00178         <span class="keywordflow">return</span> processTable[<a class="code" href="ttys_8h.html#a99a0a65415f2b25acb0d456bc9642905" title="Returns the pid of the process that is in this tty.">sysGetTTYFocusedProcess</a>(tty)].<a class="code" href="structprocess__t.html#a38a7314b52579446f9acf4f643084465">files</a>[fd];
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="comment">/* send to the buffer shell the enter line */</span>
<a name="l00182"></a>00182 <span class="keyword">static</span> <span class="keywordtype">void</span> putLine(<span class="keywordtype">void</span>)
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184         <span class="keywordtype">int</span> tty;
<a name="l00185"></a>00185         <span class="keywordtype">char</span> nl = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00186"></a>00186         
<a name="l00187"></a>00187         tty = <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>();
<a name="l00188"></a>00188         <a class="code" href="unistd_8h.html#a681fc6e35e986fe5975afb7a110830a2" title="Idem to the write() function, but to the given stream.">fwrite</a>(sysGetTTYFocusedProcessStream(tty, <a class="code" href="defs_8h.html#ac00bfb46347d26fdc58568fe1ab5fa5b" title="DefineBrief.">STDIN</a>), (<span class="keywordtype">char</span> *)(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a>-&gt;<a class="code" href="structstd_in_t_t_y.html#adbc1696a6e5a5d97b6761336fc185945">stdInBuffer</a>), ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a>-&gt;<a class="code" href="structstd_in_t_t_y.html#ada738b143166d2de18a92ff55801f41b">writeOffset</a>);
<a name="l00189"></a>00189         <a class="code" href="unistd_8h.html#a681fc6e35e986fe5975afb7a110830a2" title="Idem to the write() function, but to the given stream.">fwrite</a>(sysGetTTYFocusedProcessStream(tty, <a class="code" href="defs_8h.html#ac00bfb46347d26fdc58568fe1ab5fa5b" title="DefineBrief.">STDIN</a>), &amp;nl, 1);
<a name="l00190"></a>00190         <a class="code" href="sys_process_8h.html#a7cf69c15da459e564717f8116eb75c57" title="Signals the given tty so that any blocked process from it can be unblocked.">signalTty</a>(tty);
<a name="l00191"></a>00191         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a>-&gt;<a class="code" href="structstd_in_t_t_y.html#ada738b143166d2de18a92ff55801f41b">writeOffset</a> = 0;
<a name="l00192"></a>00192         kbOffset[tty] = 0;
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="comment">/* Parse the alarm control character */</span>
<a name="l00196"></a>00196 <span class="keyword">static</span> <span class="keywordtype">void</span> parseAlarmTTY( <span class="keywordtype">int</span> where, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty )
<a name="l00197"></a>00197 {
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="comment">/* Parse the backspace control character */</span>
<a name="l00201"></a>00201 <span class="keyword">static</span> <span class="keywordtype">void</span> parseBackSpaceTTY( <span class="keywordtype">int</span> where, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty )
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203         <span class="keyword">static</span> <span class="keywordtype">int</span> cond = <a class="code" href="defs_8h.html#aa93f0eb578d23995850d61f7d61c55c1" title="DefineBrief.">FALSE</a>;
<a name="l00204"></a>00204         <span class="keywordtype">int</span> i;
<a name="l00205"></a>00205         
<a name="l00206"></a>00206         <span class="keywordflow">if</span> (!where)
<a name="l00207"></a>00207         {       
<a name="l00208"></a>00208                 <span class="keywordflow">if</span> (kbOffset[tty] &gt; 0){
<a name="l00209"></a>00209                         cond = <a class="code" href="defs_8h.html#aa93f0eb578d23995850d61f7d61c55c1" title="DefineBrief.">FALSE</a>;
<a name="l00210"></a>00210                         --kbOffset[tty];
<a name="l00211"></a>00211                         decWritePointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>));
<a name="l00212"></a>00212                         (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a>-&gt;<a class="code" href="structstd_in_t_t_y.html#ada738b143166d2de18a92ff55801f41b">writeOffset</a>)--;
<a name="l00213"></a>00213                         <span class="keywordflow">if</span> ((ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] == <a class="code" href="config_8h.html#ad58a1fbfc85c7e4790fc55e654f50221" title="The tabular control ascii value.">TAB</a>){
<a name="l00214"></a>00214                                 <span class="keywordflow">for</span> (i = 0 ; i &lt; <a class="code" href="config_8h.html#a625199558fb05110496080e008423fa6" title="The spaces that tab prints.">VIDEO_TAB_STOP</a> - 1 ; ++i){
<a name="l00215"></a>00215                                         <span class="keywordflow">if</span> ((ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] != <a class="code" href="config_8h.html#ad58a1fbfc85c7e4790fc55e654f50221" title="The tabular control ascii value.">TAB</a>)
<a name="l00216"></a>00216                                                 <span class="keywordflow">break</span>;
<a name="l00217"></a>00217                                         --kbOffset[tty];
<a name="l00218"></a>00218                                         <a class="code" href="video__driver_8h.html#acbe81cee62ff6277f842beb233a30ba2" title="Brief.">printBackspace</a>();
<a name="l00219"></a>00219                                         (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] = <span class="charliteral">&#39; &#39;</span>;
<a name="l00220"></a>00220                                         decWritePointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>));
<a name="l00221"></a>00221                                         --(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a>-&gt;<a class="code" href="structstd_in_t_t_y.html#ada738b143166d2de18a92ff55801f41b">writeOffset</a>);
<a name="l00222"></a>00222                                 }
<a name="l00223"></a>00223                                 cond = <a class="code" href="defs_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d" title="DefineBrief.">TRUE</a>;
<a name="l00224"></a>00224                         }
<a name="l00225"></a>00225                         <span class="keywordflow">if</span> (!cond || (cond &amp;&amp; i == VIDEO_TAB_STOP - 1)){
<a name="l00226"></a>00226                                 <a class="code" href="video__driver_8h.html#acbe81cee62ff6277f842beb233a30ba2" title="Brief.">printBackspace</a>();
<a name="l00227"></a>00227                                 (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] = <span class="charliteral">&#39; &#39;</span>;
<a name="l00228"></a>00228                         }
<a name="l00229"></a>00229                 }
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         <span class="keywordflow">else</span>{
<a name="l00232"></a>00232                 <span class="keywordflow">if</span> (cond){
<a name="l00233"></a>00233                         <span class="keywordflow">for</span> (i = 0 ; i &lt; VIDEO_TAB_STOP ; ++i)
<a name="l00234"></a>00234                                 <a class="code" href="video__driver_8h.html#acbe81cee62ff6277f842beb233a30ba2" title="Brief.">printBackspace</a>();
<a name="l00235"></a>00235                         cond = <a class="code" href="defs_8h.html#aa93f0eb578d23995850d61f7d61c55c1" title="DefineBrief.">FALSE</a>;
<a name="l00236"></a>00236                 }
<a name="l00237"></a>00237                 <span class="keywordflow">else</span>
<a name="l00238"></a>00238                         <a class="code" href="video__driver_8h.html#acbe81cee62ff6277f842beb233a30ba2" title="Brief.">printBackspace</a> ();
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240         
<a name="l00241"></a>00241         <span class="keywordflow">return</span>;
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="comment">/* Parse the tab control character */</span>
<a name="l00245"></a>00245 <span class="keyword">static</span> <span class="keywordtype">void</span> parseTabTTY( <span class="keywordtype">int</span> where, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty )
<a name="l00246"></a>00246 {       
<a name="l00247"></a>00247         <span class="keywordtype">int</span> i, prevRow;
<a name="l00248"></a>00248         
<a name="l00249"></a>00249         <span class="keywordflow">if</span>( !where ){
<a name="l00250"></a>00250                 <span class="keywordflow">for</span> ( i = 0, prevRow = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>; i &lt; VIDEO_TAB_STOP ; ++i )
<a name="l00251"></a>00251                 {
<a name="l00252"></a>00252                         <span class="keywordflow">if</span> ( prevRow != ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a> )
<a name="l00253"></a>00253                                 <span class="keywordflow">break</span>;
<a name="l00254"></a>00254                         (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] = <a class="code" href="config_8h.html#ad58a1fbfc85c7e4790fc55e654f50221" title="The tabular control ascii value.">TAB</a>;
<a name="l00255"></a>00255                         incWritePointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>) );              
<a name="l00256"></a>00256                 }
<a name="l00257"></a>00257         }
<a name="l00258"></a>00258         <span class="keywordflow">else</span>{
<a name="l00259"></a>00259                 <a class="code" href="video__driver_8h.html#ab78eb9f4419ae3178c008da766c346b8" title="Puts a character into the video buffer at the current position and moves the cursor...">printChar</a>(<span class="charliteral">&#39; &#39;</span>);
<a name="l00260"></a>00260                 incReadPointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a>));
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="comment">/* Parse the newline control character */</span>
<a name="l00265"></a>00265 <span class="keyword">static</span> <span class="keywordtype">void</span> parseNewLineTTY( <span class="keywordtype">int</span> where, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty )
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267         <span class="keywordflow">if</span>( !where ){
<a name="l00268"></a>00268                 (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] = <a class="code" href="config_8h.html#a7b99dc1e1c86b4897498c2d436ead1b5" title="The new line control ascii value.">NEW_LINE</a>;
<a name="l00269"></a>00269                 <span class="keywordflow">do</span>
<a name="l00270"></a>00270                 {
<a name="l00271"></a>00271                         incWritePointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>) );
<a name="l00272"></a>00272                 } <span class="keywordflow">while</span> ( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a> != 0 );
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274         <span class="keywordflow">else</span>{
<a name="l00275"></a>00275                 <a class="code" href="video__driver_8h.html#a33969be99f454fe7ad78c027d47c9053" title="Brief.">printNewLine</a>();
<a name="l00276"></a>00276                 <span class="keywordflow">do</span>
<a name="l00277"></a>00277                 {
<a name="l00278"></a>00278                         incReadPointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a>) );
<a name="l00279"></a>00279                 } <span class="keywordflow">while</span> ( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> != 0 );
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 <span class="comment">/* Parse the vertical tab control character */</span>
<a name="l00284"></a>00284 <span class="keyword">static</span> <span class="keywordtype">void</span> parseVTabTTY( <span class="keywordtype">int</span> where, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty )
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286         <span class="keywordtype">int</span> i, col;
<a name="l00287"></a>00287         
<a name="l00288"></a>00288         <span class="keywordflow">if</span>( !where ){
<a name="l00289"></a>00289                 (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] = <a class="code" href="config_8h.html#ae32038c6d240009ae8ca21911e89c089" title="The vertical tab control ascii value.">VTAB</a>;
<a name="l00290"></a>00290                 col = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a> - 1;
<a name="l00291"></a>00291                 for ( i = 0; i &lt; <a class="code" href="config_8h.html#a1a24019cfbf00c9425f1aefb18421453" title="The vertical tab spaces.">VIDEO_VTAB_STOP</a>; ++i )
<a name="l00292"></a>00292                         parseNewLineTTY( where, tty);
<a name="l00293"></a>00293                 <span class="keywordflow">while</span> ( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a> &lt; col )
<a name="l00294"></a>00294                         incWritePointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>) );
<a name="l00295"></a>00295         } 
<a name="l00296"></a>00296         <span class="keywordflow">else</span>{
<a name="l00297"></a>00297                 <a class="code" href="video__driver_8h.html#ab6c84a2c68bc7176a73f7312b76775a8" title="Brief.">printVTab</a>();
<a name="l00298"></a>00298                 col = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> - 1;
<a name="l00299"></a>00299                 <span class="keywordflow">for</span> ( i = 0; i &lt; VIDEO_VTAB_STOP; ++i )
<a name="l00300"></a>00300                         parseNewLineTTY( where, tty);
<a name="l00301"></a>00301                 <span class="keywordflow">while</span> ( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> &lt; col )
<a name="l00302"></a>00302                         incReadPointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a>) );
<a name="l00303"></a>00303         }
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">/* Parse the line feed control character */</span>
<a name="l00307"></a>00307 <span class="keyword">static</span> <span class="keywordtype">void</span> parseLineFeedTTY( <span class="keywordtype">int</span> where, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty )
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309         <span class="keywordtype">int</span> col;
<a name="l00310"></a>00310         
<a name="l00311"></a>00311         <span class="keywordflow">if</span>( !where ){
<a name="l00312"></a>00312                 (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] = <a class="code" href="config_8h.html#a3c2cad5489953de23c5733e6e696a93e" title="The line feed control ascii value.">LINE_FEED</a>;
<a name="l00313"></a>00313                 parseNewLineTTY(where, tty);
<a name="l00314"></a>00314                 col = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>;
<a name="l00315"></a>00315                 <span class="keywordflow">do</span>
<a name="l00316"></a>00316                 {
<a name="l00317"></a>00317                         incWritePointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>) );
<a name="l00318"></a>00318                 } <span class="keywordflow">while</span> ( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a> == col );
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320         <span class="keywordflow">else</span>{
<a name="l00321"></a>00321                 <a class="code" href="video__driver_8h.html#a87a84573dc8e6aa7520e2840bde5dbf8" title="Brief.">printLineFeed</a>();
<a name="l00322"></a>00322                 col = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a>;
<a name="l00323"></a>00323                 <span class="keywordflow">do</span>
<a name="l00324"></a>00324                 {
<a name="l00325"></a>00325                         incReadPointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a>) );
<a name="l00326"></a>00326                 } <span class="keywordflow">while</span> ( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> == col );
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="comment">/* Parse the return control character */</span>
<a name="l00331"></a>00331 <span class="keyword">static</span> <span class="keywordtype">void</span> parseReturnTTY( <span class="keywordtype">int</span> where, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty )
<a name="l00332"></a>00332 {
<a name="l00333"></a>00333         <span class="keywordflow">if</span>( !where ){
<a name="l00334"></a>00334                 (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] = <a class="code" href="config_8h.html#a6a0e6b80dd3d5ca395cf58151749f5e2" title="The return control ascii value.">RETURN</a>;
<a name="l00335"></a>00335                 while ( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a> != 0 )
<a name="l00336"></a>00336                         decWritePointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>) );
<a name="l00337"></a>00337         }<span class="keywordflow">else</span>{
<a name="l00338"></a>00338                 <a class="code" href="video__driver_8h.html#a1ba23d1cbd358745c50fa2bf28a8c019" title="Brief.">printReturn</a>();
<a name="l00339"></a>00339                 <span class="keywordflow">while</span> ( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> != 0 )
<a name="l00340"></a>00340                         decReadPointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a>));
<a name="l00341"></a>00341         }
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 <span class="comment">/* Parse the character and determine what it has to do */</span>
<a name="l00345"></a>00345 <span class="keyword">static</span> <span class="keywordtype">int</span> parseCharTTY( <span class="keywordtype">int</span> c, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty, <span class="keywordtype">int</span> inStdIn)
<a name="l00346"></a>00346 {
<a name="l00347"></a>00347         <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> focusTTY;
<a name="l00348"></a>00348         <span class="keyword">static</span> <a class="code" href="ttys_8c.html#a66d44f0f200f3be2f975a30a9be6e030">printFunctions</a> specialCharPrint[] = {
<a name="l00349"></a>00349                 parseAlarmTTY,
<a name="l00350"></a>00350                 parseBackSpaceTTY,
<a name="l00351"></a>00351                 parseTabTTY,
<a name="l00352"></a>00352                 parseNewLineTTY,
<a name="l00353"></a>00353                 parseVTabTTY,
<a name="l00354"></a>00354                 parseLineFeedTTY,
<a name="l00355"></a>00355                 parseReturnTTY
<a name="l00356"></a>00356         };
<a name="l00357"></a>00357         
<a name="l00358"></a>00358         focusTTY = <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>();
<a name="l00359"></a>00359 
<a name="l00360"></a>00360         <span class="keywordflow">if</span> (<span class="charliteral">&#39;\a&#39;</span> &lt;= c &amp;&amp; c &lt;= <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; c != <span class="charliteral">&#39;\n&#39;</span>)
<a name="l00361"></a>00361         {
<a name="l00362"></a>00362                 <span class="keywordflow">if</span> (!inStdIn || (inStdIn &amp;&amp; c != <span class="charliteral">&#39;\t&#39;</span> &amp;&amp; (c != <span class="charliteral">&#39;\t&#39;</span> || kbOffset[tty] &lt; <a class="code" href="config_8h.html#a842ed03f27719bc87666bfd1f75415b8" title="The length of the shell buffer.">MAX_LINE</a> - VIDEO_TAB_STOP - 1)) ){
<a name="l00363"></a>00363                 
<a name="l00364"></a>00364                         specialCharPrint[c - <span class="charliteral">&#39;\a&#39;</span>](<a class="code" href="defs_8h.html#ae30b01f0637fa2a2ef0ee72fbbaee2a2" title="DefineBrief.">WRITE_ON_TTY</a>, tty);
<a name="l00365"></a>00365                 
<a name="l00366"></a>00366                         <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\t&#39;</span> &amp;&amp; inStdIn){
<a name="l00367"></a>00367                                 kbOffset[tty] += VIDEO_TAB_STOP;
<a name="l00368"></a>00368                         }
<a name="l00369"></a>00369                         <span class="keywordflow">if</span> ((inStdIn &amp;&amp; c != <span class="charliteral">&#39;\b&#39;</span>) || (tty == focusTTY &amp;&amp; !inStdIn)){
<a name="l00370"></a>00370                                 videoParserFunctions[c - <span class="charliteral">&#39;\a&#39;</span>]();
<a name="l00371"></a>00371                         }
<a name="l00372"></a>00372                 }
<a name="l00373"></a>00373                 
<a name="l00374"></a>00374                 <span class="keywordflow">return</span> 0;
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\n&#39;</span>){
<a name="l00377"></a>00377                 <span class="keywordflow">if</span> (inStdIn)
<a name="l00378"></a>00378                         putLine();
<a name="l00379"></a>00379                 <span class="keywordflow">else</span>
<a name="l00380"></a>00380                         specialCharPrint[c - <span class="charliteral">&#39;\a&#39;</span>](WRITE_ON_TTY, tty);
<a name="l00381"></a>00381                 <span class="keywordflow">if</span> (tty == focusTTY &amp;&amp; !inStdIn){
<a name="l00382"></a>00382                         videoParserFunctions[c - <span class="charliteral">&#39;\a&#39;</span>]();
<a name="l00383"></a>00383                 }
<a name="l00384"></a>00384                 <span class="keywordflow">return</span> 0;
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386         <span class="keywordflow">else</span>{
<a name="l00387"></a>00387                 <span class="keywordflow">if</span> (!inStdIn || (inStdIn &amp;&amp; kbOffset[tty] &lt; <a class="code" href="config_8h.html#a842ed03f27719bc87666bfd1f75415b8" title="The length of the shell buffer.">MAX_LINE</a> - 1)){
<a name="l00388"></a>00388                         ((ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty])-&gt;stdOut-&gt;stdOutBuffer)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>] = c;
<a name="l00389"></a>00389                         <span class="keywordflow">if</span> (inStdIn){
<a name="l00390"></a>00390                                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a>-&gt;<a class="code" href="structstd_in_t_t_y.html#adbc1696a6e5a5d97b6761336fc185945">stdInBuffer</a>[(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a44c2fc56a32fd5125ebc51b6b2c0e178">stdIn</a>-&gt;<a class="code" href="structstd_in_t_t_y.html#ada738b143166d2de18a92ff55801f41b">writeOffset</a>)++]= c;
<a name="l00391"></a>00391                                 ++kbOffset[tty];
<a name="l00392"></a>00392                         }
<a name="l00393"></a>00393                         <span class="keywordflow">if</span> (inStdIn || tty == focusTTY)
<a name="l00394"></a>00394                                 <a class="code" href="video__driver_8h.html#ab78eb9f4419ae3178c008da766c346b8" title="Puts a character into the video buffer at the current position and moves the cursor...">printChar</a>(c);
<a name="l00395"></a>00395                         incWritePointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>) );              
<a name="l00396"></a>00396                 }
<a name="l00397"></a>00397                 <span class="keywordflow">return</span> 1;
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 <span class="comment">/* Refresh all buffers of the tty */</span>
<a name="l00402"></a>00402 <span class="keyword">static</span> <span class="keywordtype">void</span> refreshScreenTTY( <span class="keywordtype">void</span> )
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404         <span class="keywordtype">int</span> character;
<a name="l00405"></a>00405         <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> focusTTY;
<a name="l00406"></a>00406         <span class="keyword">static</span> <a class="code" href="ttys_8c.html#a66d44f0f200f3be2f975a30a9be6e030">printFunctions</a> refreshCharPrint[] = {
<a name="l00407"></a>00407                 parseAlarmTTY,
<a name="l00408"></a>00408                 parseBackSpaceTTY,
<a name="l00409"></a>00409                 parseTabTTY,
<a name="l00410"></a>00410                 parseNewLineTTY,
<a name="l00411"></a>00411                 parseVTabTTY,
<a name="l00412"></a>00412                 parseLineFeedTTY,
<a name="l00413"></a>00413                 parseReturnTTY
<a name="l00414"></a>00414         };
<a name="l00415"></a>00415         
<a name="l00416"></a>00416         focusTTY = <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>();
<a name="l00417"></a>00417         
<a name="l00418"></a>00418         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a> = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a> = 0;
<a name="l00419"></a>00419         <span class="keywordflow">if</span>( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a5be2ba5c5e17899443300974060fe13f">hasScrolled</a> &gt; 0 ){
<a name="l00420"></a>00420                 
<a name="l00421"></a>00421                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a> = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>;
<a name="l00422"></a>00422                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>;
<a name="l00423"></a>00423                 <span class="keywordflow">do</span>{
<a name="l00424"></a>00424                         incReadPointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a>));
<a name="l00425"></a>00425                 }<span class="keywordflow">while</span>( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> != 0 );
<a name="l00426"></a>00426                 
<a name="l00427"></a>00427                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a> = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a> + 1;
<a name="l00428"></a>00428                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> = 0;
<a name="l00429"></a>00429         }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431         <span class="keywordflow">while</span>( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a> != ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a> ){
<a name="l00432"></a>00432                 
<a name="l00433"></a>00433                 <span class="keywordflow">if</span>( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a> == <a class="code" href="config_8h.html#a6cacb150853456c97c51481e67d0dabc" title="Real screen size without color attribute.">SCREEN_SIZE</a> ){
<a name="l00434"></a>00434                         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a> = 0;
<a name="l00435"></a>00435                         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a> = 0;
<a name="l00436"></a>00436                         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a> = 0;
<a name="l00437"></a>00437                 }
<a name="l00438"></a>00438                 character = (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a>];
<a name="l00439"></a>00439                 <span class="keywordflow">if</span>( <span class="charliteral">&#39;\a&#39;</span> &lt;= character &amp;&amp; character &lt;= <span class="charliteral">&#39;\r&#39;</span> )
<a name="l00440"></a>00440                 {
<a name="l00441"></a>00441                         refreshCharPrint[character - <span class="charliteral">&#39;\a&#39;</span>](<a class="code" href="defs_8h.html#ad930a240d62012e99d9f9dc2b618b3e8" title="DefineBrief.">SEND_TO_VIDEO</a>, focusTTY);
<a name="l00442"></a>00442                 }<span class="keywordflow">else</span>
<a name="l00443"></a>00443                 {
<a name="l00444"></a>00444                         <a class="code" href="video__driver_8h.html#ab78eb9f4419ae3178c008da766c346b8" title="Puts a character into the video buffer at the current position and moves the cursor...">printChar</a>(character);
<a name="l00445"></a>00445                         incReadPointer( &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#aa0a6145a711115035caf96d6d1c7d9fb">readPointer</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a38beda239dc9e9eb6f58cc2e818fbaa6">readCol</a>), &amp;(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[focusTTY]-&gt;<a class="code" href="structtty__s.html#a0aef55ec53e97b2ad384eb814d316e9b">readRow</a>));
<a name="l00446"></a>00446                 }
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448 }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 <span class="comment">/* Print a stirng in the specific tty */</span>
<a name="l00451"></a><a class="code" href="ttys_8c.html#a0ecf720256fc5769d712a4e4190946f1">00451</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#a0ecf720256fc5769d712a4e4190946f1" title="This function prints a string in a specific tty. It checks if it has to print only...">putsTTY</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> count, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty )
<a name="l00452"></a>00452 {
<a name="l00453"></a>00453         <span class="keywordflow">while</span>( count-- &gt;= 0 )
<a name="l00454"></a>00454                 <a class="code" href="ttys_8h.html#a8b368b52e988f2fb5f99aeb979fe4040" title="It prints only one character in specific tty. It verifies if the character is a control...">putCharTTY</a>(*name++, tty, <a class="code" href="defs_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d" title="DefineBrief.">TRUE</a>);
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="comment">/* Put a char into the tty and verifies if it has to put in Stdin too */</span>
<a name="l00458"></a><a class="code" href="ttys_8c.html#a8b368b52e988f2fb5f99aeb979fe4040">00458</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#a8b368b52e988f2fb5f99aeb979fe4040" title="It prints only one character in specific tty. It verifies if the character is a control...">putCharTTY</a>( <span class="keywordtype">char</span> c, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty, <span class="keywordtype">int</span> inStdIn )
<a name="l00459"></a>00459 {       
<a name="l00460"></a>00460         <span class="keywordtype">int</span> parse;
<a name="l00461"></a>00461         
<a name="l00462"></a>00462         <span class="keywordflow">if</span>( ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a> == <a class="code" href="config_8h.html#a6cacb150853456c97c51481e67d0dabc" title="Real screen size without color attribute.">SCREEN_SIZE</a> )
<a name="l00463"></a>00463         {
<a name="l00464"></a>00464                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a> = 0;
<a name="l00465"></a>00465                 ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a5be2ba5c5e17899443300974060fe13f">hasScrolled</a>++;
<a name="l00466"></a>00466         }
<a name="l00467"></a>00467         parse = parseCharTTY(c, tty, inStdIn);
<a name="l00468"></a>00468 }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470 <span class="comment">/* return the id of the tty that is in focus */</span>
<a name="l00471"></a><a class="code" href="ttys_8c.html#ac625c448f0a3f2dd24c1409227e291e4">00471</a> <span class="keywordtype">int</span> <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>( <span class="keywordtype">void</span> ) 
<a name="l00472"></a>00472 {
<a name="l00473"></a>00473         <span class="keywordflow">return</span> ttyTable.<a class="code" href="structsys_t_t_y.html#ad4f84dd55c369a7bd7d9f562fc76662f">focusTTY</a>;
<a name="l00474"></a>00474 }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 <span class="comment">/* put a char into the tty that is in focus */</span>
<a name="l00477"></a>00477 <span class="keyword">static</span> <span class="keywordtype">void</span> putTTY(<a class="code" href="types_8h.html#a90ed3c9028a7fa45665d10b5210fa142" title="Keycode typedef.">Keycode</a> c){
<a name="l00478"></a>00478         <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty;
<a name="l00479"></a>00479         
<a name="l00480"></a>00480         tty = <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>();
<a name="l00481"></a>00481         <span class="keywordflow">if</span>(<a class="code" href="unistd_8h.html#a681fc6e35e986fe5975afb7a110830a2" title="Idem to the write() function, but to the given stream.">fwrite</a>(sysGetTTYFocusedProcessStream(tty, <a class="code" href="defs_8h.html#ac00bfb46347d26fdc58568fe1ab5fa5b" title="DefineBrief.">STDIN</a>), (<span class="keywordtype">char</span> *)&amp;c, 1) == 1){
<a name="l00482"></a>00482                 <a class="code" href="sys_process_8h.html#a7cf69c15da459e564717f8116eb75c57" title="Signals the given tty so that any blocked process from it can be unblocked.">signalTty</a>(tty);
<a name="l00483"></a>00483         }       
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 <span class="comment">/* dequeue characters from the keyboard buffer, and decides if it has to putchar or change tty */</span>
<a name="l00487"></a><a class="code" href="ttys_8c.html#abbca9cfc412d307fa56ca4a4095f0f87">00487</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#abbca9cfc412d307fa56ca4a4095f0f87" title="Leaves all of character that are in the KeyboradBuffer and put in the correct tty...">refreshKeyboardBufferTTY</a>( <span class="keywordtype">void</span> ){
<a name="l00488"></a>00488         <a class="code" href="types_8h.html#a90ed3c9028a7fa45665d10b5210fa142" title="Keycode typedef.">Keycode</a> deChar = 0;
<a name="l00489"></a>00489         <span class="keywordtype">int</span> color;
<a name="l00490"></a>00490         
<a name="l00491"></a>00491         color = <a class="code" href="video__driver_8h.html#a9890a0e1d4b684976b56495795445c77" title="Gets the actual default video color.">getVideoColor</a>();
<a name="l00492"></a>00492 
<a name="l00493"></a>00493         <span class="keywordflow">while</span>( !<a class="code" href="queue_8h.html#ab50e760055a693e439a8ac83cedee6bd" title="return if the buffer is empty">kbBufferIsEmpty</a>() ){
<a name="l00494"></a>00494                 <span class="keywordflow">if</span>( (deChar = <a class="code" href="queue_8h.html#af7d9739d980ebb59fabce9dab6379f3b" title="Dequeue an element while the buffer is not Empty.">charDeque</a>()) != <span class="charliteral">&#39;\0&#39;</span> )
<a name="l00495"></a>00495                 {
<a name="l00496"></a>00496                         <span class="keywordflow">if</span>( 0x81 &lt;= deChar &amp;&amp; deChar &lt;= 0x88  ){
<a name="l00497"></a>00497                                 <a class="code" href="ttys_8h.html#aac09c476e825138ad51c1c5948f47748" title="This function changes the tty focus id on the next Tty that has to be in focus. This...">changeFocusTTY</a>( (deChar - 0x81) );
<a name="l00498"></a>00498                                 <span class="keywordflow">break</span>;
<a name="l00499"></a>00499                         }
<a name="l00500"></a>00500                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( deChar == 0x8A ){
<a name="l00501"></a>00501                                 <a class="code" href="process_8h.html#a650cf0caaaa8b75f653c1c92818d03a4" title="Kills the given pid process.">kill</a>(ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[ttyTable.<a class="code" href="structsys_t_t_y.html#ad4f84dd55c369a7bd7d9f562fc76662f">focusTTY</a>]-&gt;<a class="code" href="structtty__s.html#afefb5a7d2161ce434bcc2bbb358d5b0b">focusProcess</a>);
<a name="l00502"></a>00502                         }
<a name="l00503"></a>00503                         <span class="keywordflow">else</span>{
<a name="l00504"></a>00504                                 <span class="keywordflow">if</span>(<a class="code" href="sys_process_8h.html#aa1cd2078219adc47ca22033bf86a76be" title="Retrieves the OS process table.">getProcessTable</a>()[ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[ttyTable.<a class="code" href="structsys_t_t_y.html#ad4f84dd55c369a7bd7d9f562fc76662f">focusTTY</a>]-&gt;<a class="code" href="structtty__s.html#afefb5a7d2161ce434bcc2bbb358d5b0b">focusProcess</a>].<a class="code" href="structprocess__t.html#a5db9aa2a3238730b35b1b99a3932b030">ttyMode</a>  == <a class="code" href="defs_8h.html#afd70646efe5984e361c17010322a5711" title="DefineBrief.">TTY_CANONICAL</a>){
<a name="l00505"></a>00505                                         <a class="code" href="ttys_8h.html#a8b368b52e988f2fb5f99aeb979fe4040" title="It prints only one character in specific tty. It verifies if the character is a control...">putCharTTY</a>((<span class="keywordtype">int</span>)deChar, <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>(), <a class="code" href="defs_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d" title="DefineBrief.">TRUE</a>);
<a name="l00506"></a>00506                                 }
<a name="l00507"></a>00507                                 <span class="keywordflow">else</span>{
<a name="l00508"></a>00508                                         putTTY((<span class="keywordtype">int</span>)deChar);
<a name="l00509"></a>00509                                 }
<a name="l00510"></a>00510                         }
<a name="l00511"></a>00511                 }
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 <span class="comment">/* Change the focus tty */</span>
<a name="l00516"></a><a class="code" href="ttys_8c.html#aac09c476e825138ad51c1c5948f47748">00516</a> <span class="keywordtype">int</span> <a class="code" href="ttys_8h.html#aac09c476e825138ad51c1c5948f47748" title="This function changes the tty focus id on the next Tty that has to be in focus. This...">changeFocusTTY</a>( <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> nextTty ){    
<a name="l00517"></a>00517         
<a name="l00518"></a>00518         <span class="keywordflow">if</span>( nextTty == <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>() )
<a name="l00519"></a>00519                 <span class="keywordflow">return</span> 1;
<a name="l00520"></a>00520         <a class="code" href="video__driver_8h.html#a67e96e514d9f296c79378f7fbfba457a">clearScreen</a>();
<a name="l00521"></a>00521         ttyTable.<a class="code" href="structsys_t_t_y.html#ad4f84dd55c369a7bd7d9f562fc76662f">focusTTY</a> = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[nextTty]-&gt;<a class="code" href="structtty__s.html#a7bdcbca143d0773edef7d01762d42aff">ttyId</a>;
<a name="l00522"></a>00522         <a class="code" href="video__driver_8h.html#aff96fa4091dd99b631277b28be9a5e65" title="Sets the cursor&amp;#39;s position.">setCursorPosition</a>(0,0);
<a name="l00523"></a>00523         refreshScreenTTY();
<a name="l00524"></a>00524         <a class="code" href="video__driver_8h.html#ab59b086c41d506e55aa02729f9916be2" title="Updates all changes made to video buffer into screen.">refreshScreen</a>();
<a name="l00525"></a>00525         <span class="keywordflow">return</span> 0;
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 <span class="comment">/* Put chars into the STDOUT of the running process */</span>
<a name="l00529"></a><a class="code" href="ttys_8c.html#a5543e64588b3c8d57ef150404d96c5a7">00529</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#a5543e64588b3c8d57ef150404d96c5a7" title="Pust all of character that are in the STDOUT and and puts in the tty STDOUT who is...">refreshStdout</a>(<span class="keywordtype">void</span>){
<a name="l00530"></a>00530         <span class="keywordtype">char</span> aux;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532         <span class="keywordflow">while</span>(<a class="code" href="unistd_8h.html#a116146ccc01b751779e5351615743547" title="read() reads &amp;quot;count&amp;quot; bytes from the file descripted by the file descriptor...">read</a>(<a class="code" href="defs_8h.html#a8875037d0772a4fc34516f1e03d7e238" title="DefineBrief.">STDOUT</a>, &amp;aux, 1 ) == 1){
<a name="l00533"></a>00533                 <a class="code" href="ttys_8h.html#a8b368b52e988f2fb5f99aeb979fe4040" title="It prints only one character in specific tty. It verifies if the character is a control...">putCharTTY</a>(aux, runningProcess-&gt;<a class="code" href="structprocess__t.html#af7f414d19241988592fad1bc470e8761">tty</a>, <a class="code" href="defs_8h.html#aa93f0eb578d23995850d61f7d61c55c1" title="DefineBrief.">FALSE</a>);
<a name="l00534"></a>00534         }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 <span class="comment">/* Refresh focus tty */</span>
<a name="l00539"></a><a class="code" href="ttys_8c.html#aa0c166c59cfd83d43839b76afe6ac3ce">00539</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#aa0c166c59cfd83d43839b76afe6ac3ce" title="This functions check if the proccess if different of init and the running process...">refreshTTY</a>(<span class="keywordtype">void</span>){
<a name="l00540"></a>00540 
<a name="l00541"></a>00541         <a class="code" href="video__driver_8h.html#ab59b086c41d506e55aa02729f9916be2" title="Updates all changes made to video buffer into screen.">refreshScreen</a>();
<a name="l00542"></a>00542         <span class="keywordflow">if</span>(runningProcess != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a> &amp;&amp; runningProcess != initProcess &amp;&amp; runningProcess-&gt;<a class="code" href="structprocess__t.html#ae0d46a978d5cd6707411f276ad869b9c">pid</a> &gt; 0 &amp;&amp; runningProcess-&gt;<a class="code" href="structprocess__t.html#af7f414d19241988592fad1bc470e8761">tty</a> != -1){
<a name="l00543"></a>00543                 <a class="code" href="ttys_8h.html#a5543e64588b3c8d57ef150404d96c5a7" title="Pust all of character that are in the STDOUT and and puts in the tty STDOUT who is...">refreshStdout</a>();
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545         
<a name="l00546"></a>00546         <span class="keywordflow">return</span>;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="comment">/*</span>
<a name="l00550"></a>00550 <span class="comment"> *Public Functions</span>
<a name="l00551"></a>00551 <span class="comment"> */</span>
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 <span class="comment">/* Set the pid to the process that is in focus, for this tty */</span>
<a name="l00554"></a><a class="code" href="ttys_8c.html#aca07223864f88814919b02e6729569a5">00554</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#aca07223864f88814919b02e6729569a5" title="Sets the pid to the process which is in focus.">sysSetTTYFocusedProcess</a>(<a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid, <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty){
<a name="l00555"></a>00555         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#afefb5a7d2161ce434bcc2bbb358d5b0b">focusProcess</a> = pid; 
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557  <span class="comment">/* get the pid of the process that is in focus of this tty */</span>
<a name="l00558"></a><a class="code" href="ttys_8c.html#a99a0a65415f2b25acb0d456bc9642905">00558</a> <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> <a class="code" href="ttys_8h.html#a99a0a65415f2b25acb0d456bc9642905" title="Returns the pid of the process that is in this tty.">sysGetTTYFocusedProcess</a>(<a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty){
<a name="l00559"></a>00559         <span class="keywordflow">return</span> ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#afefb5a7d2161ce434bcc2bbb358d5b0b">focusProcess</a>;
<a name="l00560"></a>00560 }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 <span class="comment">/* Clean the stdout buffer of the running process tty */</span>
<a name="l00563"></a><a class="code" href="ttys_8c.html#a6083aac7b79f2adcd3c4d6fbf479f283">00563</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#a6083aac7b79f2adcd3c4d6fbf479f283" title="It clears the stdout of the tty that is in focus.">clearTTYScreen</a>()
<a name="l00564"></a>00564 {
<a name="l00565"></a>00565         <span class="keywordtype">int</span> clear = 0;
<a name="l00566"></a>00566         <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty;
<a name="l00567"></a>00567         
<a name="l00568"></a>00568         <span class="keywordflow">if</span> ((tty = runningProcess-&gt;<a class="code" href="structprocess__t.html#af7f414d19241988592fad1bc470e8761">tty</a>) &lt; 0 || tty &gt; <a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>)
<a name="l00569"></a>00569                 <span class="keywordflow">return</span>;
<a name="l00570"></a>00570         
<a name="l00571"></a>00571         <span class="keywordflow">while</span>( clear != <a class="code" href="config_8h.html#a6cacb150853456c97c51481e67d0dabc" title="Real screen size without color attribute.">SCREEN_SIZE</a> )
<a name="l00572"></a>00572         {
<a name="l00573"></a>00573                 (ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0651a2e4ac304fdc5837a8eb0b0bd166">stdOut</a>-&gt;<a class="code" href="structstd_out_t_t_y.html#aef253d03c960d4ee76bc0f0f84236f8b">stdOutBuffer</a>)[clear] = <span class="charliteral">&#39; &#39;</span>;
<a name="l00574"></a>00574                 clear++;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576         <a class="code" href="ttys_8h.html#a77495bf57af4fe0554f55dc4be4a4600" title="It sets the cursor in an specific position of the tty stdout.">setTTYCursorPosition</a>(0, 0);
<a name="l00577"></a>00577         <span class="keywordflow">if</span> (tty == <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>()){
<a name="l00578"></a>00578                 <a class="code" href="video__driver_8h.html#a67e96e514d9f296c79378f7fbfba457a">clearScreen</a>();
<a name="l00579"></a>00579                 <a class="code" href="video__driver_8h.html#aff96fa4091dd99b631277b28be9a5e65" title="Sets the cursor&amp;#39;s position.">setCursorPosition</a>(0, 0);
<a name="l00580"></a>00580         }
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 <span class="comment">/* Put the pointer in x,y position */</span>
<a name="l00584"></a><a class="code" href="ttys_8c.html#a77495bf57af4fe0554f55dc4be4a4600">00584</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#a77495bf57af4fe0554f55dc4be4a4600" title="It sets the cursor in an specific position of the tty stdout.">setTTYCursorPosition</a>( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l00585"></a>00585 {
<a name="l00586"></a>00586         <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty;
<a name="l00587"></a>00587         
<a name="l00588"></a>00588         tty = runningProcess-&gt;<a class="code" href="structprocess__t.html#af7f414d19241988592fad1bc470e8761">tty</a>;
<a name="l00589"></a>00589         
<a name="l00590"></a>00590         <span class="keywordflow">if</span>( x &gt;= <a class="code" href="config_8h.html#a25f7ae536603397e929ff4941e253200" title="The height of the screen.">SCREEN_HEIGTH</a> || y &gt;= <a class="code" href="config_8h.html#a2cd109632a6dcccaa80b43561b1ab700" title="The width of the screen.">SCREEN_WIDTH</a> || tty &lt; 0 || tty &gt; <a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>)
<a name="l00591"></a>00591                 <span class="keywordflow">return</span>;
<a name="l00592"></a>00592                 
<a name="l00593"></a>00593         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a> = <a class="code" href="config_8h.html#a2cd109632a6dcccaa80b43561b1ab700" title="The width of the screen.">SCREEN_WIDTH</a> * x + y;
<a name="l00594"></a>00594         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a> = x;
<a name="l00595"></a>00595         ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a> = y;
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (tty == <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>()){
<a name="l00597"></a>00597                 <a class="code" href="video__driver_8h.html#aff96fa4091dd99b631277b28be9a5e65" title="Sets the cursor&amp;#39;s position.">setCursorPosition</a>(x, y);
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601 <span class="comment">/* put chat at tty position buffer */</span>
<a name="l00602"></a><a class="code" href="ttys_8c.html#a0ae5938446774e4ebb46d0f5120458a8">00602</a> <span class="keywordtype">void</span> <a class="code" href="ttys_8h.html#a0ae5938446774e4ebb46d0f5120458a8" title="It puts a character in a specific position of the tty stdout. It prints the character...">putTTYCharAtPosition</a>( <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> row, <span class="keywordtype">int</span> col)
<a name="l00603"></a>00603 {
<a name="l00604"></a>00604         <span class="keywordtype">int</span> auxPointer, auxCol, auxRow;
<a name="l00605"></a>00605         <a class="code" href="types_8h.html#a10bbb7176245baeab9f398547c410779" title="tty_t typedef.">tty_t</a> tty;
<a name="l00606"></a>00606         
<a name="l00607"></a>00607         tty = runningProcess-&gt;<a class="code" href="structprocess__t.html#af7f414d19241988592fad1bc470e8761">tty</a>;
<a name="l00608"></a>00608         
<a name="l00609"></a>00609         <span class="keywordflow">if</span>( row &gt;= <a class="code" href="config_8h.html#a25f7ae536603397e929ff4941e253200" title="The height of the screen.">SCREEN_HEIGTH</a> || col &gt;= <a class="code" href="config_8h.html#a2cd109632a6dcccaa80b43561b1ab700" title="The width of the screen.">SCREEN_WIDTH</a> || tty &lt; 0 || tty &gt; <a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>)
<a name="l00610"></a>00610                 <span class="keywordflow">return</span>;
<a name="l00611"></a>00611         
<a name="l00612"></a>00612         auxPointer = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a3a1ce6ba5935d1763d5b04f50fee62f7">writePointer</a>;
<a name="l00613"></a>00613         auxRow = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#a0bd76a596e01d0e7b4775aab29dcf425">writeRow</a>;
<a name="l00614"></a>00614         auxCol = ttyTable.<a class="code" href="structsys_t_t_y.html#a35ea653106226d6fe2191f4f8a203d67">listTTY</a>[tty]-&gt;<a class="code" href="structtty__s.html#ae1216492f5b395a931efcab6127d0160">writeCol</a>;
<a name="l00615"></a>00615         <a class="code" href="ttys_8h.html#a77495bf57af4fe0554f55dc4be4a4600" title="It sets the cursor in an specific position of the tty stdout.">setTTYCursorPosition</a>(row, col);
<a name="l00616"></a>00616         <a class="code" href="ttys_8h.html#a8b368b52e988f2fb5f99aeb979fe4040" title="It prints only one character in specific tty. It verifies if the character is a control...">putCharTTY</a>(c, tty, <a class="code" href="defs_8h.html#aa93f0eb578d23995850d61f7d61c55c1" title="DefineBrief.">FALSE</a>);
<a name="l00617"></a>00617         <span class="keywordflow">if</span>( tty == <a class="code" href="ttys_8h.html#ac625c448f0a3f2dd24c1409227e291e4" title="This function returns the tty id of tty that are in focus at this moment. It is a...">getFocusedTTY</a>() ){
<a name="l00618"></a>00618                 <a class="code" href="video__driver_8h.html#afc86e1361fc55d70f7af70b21ba853f6" title="Puts a character into the video buffer at the current cursor position.">putCharAtCurrentPos</a>(c, <a class="code" href="video__driver_8h.html#a9890a0e1d4b684976b56495795445c77" title="Gets the actual default video color.">getVideoColor</a>());
<a name="l00619"></a>00619                 <a class="code" href="video__driver_8h.html#ab59b086c41d506e55aa02729f9916be2" title="Updates all changes made to video buffer into screen.">refreshScreen</a>();
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621         <a class="code" href="ttys_8h.html#a77495bf57af4fe0554f55dc4be4a4600" title="It sets the cursor in an specific position of the tty stdout.">setTTYCursorPosition</a>(auxRow, auxCol);
<a name="l00622"></a>00622         
<a name="l00623"></a>00623         
<a name="l00624"></a>00624         <span class="keywordflow">return</span>;
<a name="l00625"></a>00625 }
<a name="l00626"></a>00626 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue May 18 16:22:42 2010 for flying-high by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
