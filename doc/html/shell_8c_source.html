<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>flying-high: src/shell.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>src/shell.c</h1><a href="shell_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="shell_8h.html" title="The shell process module.">shell.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="keyword">static</span> <span class="keywordtype">char</span> * prompt = <span class="stringliteral">&quot;root@flyingHighOS$&gt;&quot;</span>;
<a name="l00012"></a><a class="code" href="shell_8c.html#a5b6e74f4a162bb6525b91749524eb3ff">00012</a> <span class="keywordtype">char</span> <a class="code" href="shell_8c.html#a5b6e74f4a162bb6525b91749524eb3ff">bufferA</a>[<a class="code" href="config_8h.html#a842ed03f27719bc87666bfd1f75415b8" title="The length of the shell buffer.">MAX_LINE</a>];
<a name="l00013"></a><a class="code" href="shell_8c.html#a4cdb92c386803c0cdd38d16b0d681fae">00013</a> <span class="keywordtype">char</span> <a class="code" href="shell_8c.html#a4cdb92c386803c0cdd38d16b0d681fae">bufferB</a>[<a class="code" href="config_8h.html#a842ed03f27719bc87666bfd1f75415b8" title="The length of the shell buffer.">MAX_LINE</a>];
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="keyword">static</span> <a class="code" href="structdata_slot_shell.html" title="The shell data slot struct.">dataSlotShell</a> tableDataShell[<a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>];
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="shell_8c.html#a2879dea7c1ce73666eefe0dce44ea0d9">00017</a> <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a3bffbbc4425ed2ee988c21ea67c09202" title="Initializes the data structures for the shells.">initGlobalDataShell</a>(){
<a name="l00018"></a>00018         <span class="keywordtype">int</span> i;
<a name="l00019"></a>00019         
<a name="l00020"></a>00020         <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>; i++){
<a name="l00021"></a>00021                 tableDataShell[i].<a class="code" href="structdata_slot_shell.html#ae0d46a978d5cd6707411f276ad869b9c">pid</a> = 0;
<a name="l00022"></a>00022         }
<a name="l00023"></a>00023         <span class="keywordflow">return</span> 0;
<a name="l00024"></a>00024 }
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">static</span> <span class="keywordtype">int</span> initDataShell(){
<a name="l00027"></a>00027         <span class="keywordtype">int</span> i;
<a name="l00028"></a>00028         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid ;
<a name="l00029"></a>00029         pid = <a class="code" href="process_8h.html#ac61b207337ca21b3b309593fd1a0cb82" title="Retrieves the calling process&amp;#39; pid.">getpid</a>();
<a name="l00030"></a>00030         
<a name="l00031"></a>00031         <span class="keywordflow">if</span>(pid &gt; 0){
<a name="l00032"></a>00032                 <span class="keywordflow">for</span>( i = 0; i &lt; <a class="code" href="config_8h.html#a44756bcafe20e3d49defdbab056ed7c2" title="The maximum amount of ttys.">MAX_TTY</a>; i++){
<a name="l00033"></a>00033                         <span class="keywordflow">if</span>(tableDataShell[i].pid == 0){
<a name="l00034"></a>00034                                 tableDataShell[i].<a class="code" href="structdata_slot_shell.html#ae0d46a978d5cd6707411f276ad869b9c">pid</a> = pid;
<a name="l00035"></a>00035                                 tableDataShell[i].<a class="code" href="structdata_slot_shell.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="types_8h.html#a94b1da2e055fff4d143aa6aa891f79a9a1061be6c3fb88d32829cba6f6b2be304">RUNNING</a>;
<a name="l00036"></a>00036                                 tableDataShell[i].<a class="code" href="structdata_slot_shell.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0;
<a name="l00037"></a>00037                                 tableDataShell[i].<a class="code" href="structdata_slot_shell.html#ae8b496c8abc98d4ba2e5f3d7992c93b7">lineBuffer</a> = <a class="code" href="u_malloc_8h.html#a31161ef8eddd18e7781cb947f6f627d5" title="returns a continuous segment of user memory. It could return null if there is not...">malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)* <a class="code" href="config_8h.html#a842ed03f27719bc87666bfd1f75415b8" title="The length of the shell buffer.">MAX_LINE</a>);
<a name="l00038"></a>00038                                 tableDataShell[i].<a class="code" href="structdata_slot_shell.html#a17d176b0ae4937f21ebecf9d335c1f9e">enteredCommand</a> = <a class="code" href="u_malloc_8h.html#a31161ef8eddd18e7781cb947f6f627d5" title="returns a continuous segment of user memory. It could return null if there is not...">malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)* <a class="code" href="config_8h.html#a842ed03f27719bc87666bfd1f75415b8" title="The length of the shell buffer.">MAX_LINE</a>);
<a name="l00039"></a>00039                                 <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d" title="DefineBrief.">TRUE</a>;    
<a name="l00040"></a>00040                         }
<a name="l00041"></a>00041                 }
<a name="l00042"></a>00042         }
<a name="l00043"></a>00043         <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#aa93f0eb578d23995850d61f7d61c55c1" title="DefineBrief.">FALSE</a>;
<a name="l00044"></a>00044 }
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="keyword">static</span> <span class="keywordtype">int</span> getGlobalDataIndex(){
<a name="l00047"></a>00047         <span class="keywordtype">int</span> i;
<a name="l00048"></a>00048         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid;
<a name="l00049"></a>00049         
<a name="l00050"></a>00050         pid = <a class="code" href="process_8h.html#ac61b207337ca21b3b309593fd1a0cb82" title="Retrieves the calling process&amp;#39; pid.">getpid</a>();
<a name="l00051"></a>00051         
<a name="l00052"></a>00052         <span class="keywordflow">for</span>( i = 0; i &lt; MAX_TTY; i++){
<a name="l00053"></a>00053                 <span class="keywordflow">if</span>(tableDataShell[i].pid == pid){
<a name="l00054"></a>00054                         <span class="keywordflow">return</span> i;
<a name="l00055"></a>00055                 }
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057         <span class="comment">/*Exit with error, no a valid pid, or No sta en la tabla*/</span>
<a name="l00058"></a>00058         <span class="keywordflow">return</span> -1;      
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">/* SYSTEM PROPERTIES */</span>
<a name="l00062"></a>00062 <span class="keyword">static</span> <span class="keywordtype">int</span> getColor(<span class="keywordtype">char</span> *value, <span class="keywordtype">int</span> * color)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064         <a class="code" href="string_8h.html#a54d972ccd875da7d6e9ef4afc2d9f586" title="Passes every UpperCase character from string to LowerCase.">toLowerCase</a>(value);
<a name="l00065"></a>00065         <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(value, <span class="stringliteral">&quot;black&quot;</span>) == 0  )
<a name="l00066"></a>00066                 *color = <a class="code" href="colors_8h.html#a587223a5cf6a783335c29a47bec92155">setColor</a>(<a class="code" href="colors_8h.html#a7b3b25cba33b07c303f3060fe41887f6">BLACK</a>,<a class="code" href="colors_8h.html#a7b3b25cba33b07c303f3060fe41887f6">BLACK</a>);
<a name="l00067"></a>00067         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(value, <span class="stringliteral">&quot;blue&quot;</span>) == 0 )
<a name="l00068"></a>00068                 *color = <a class="code" href="colors_8h.html#a587223a5cf6a783335c29a47bec92155">setColor</a>(<a class="code" href="colors_8h.html#a79d10e672abb49ad63eeaa8aaef57c38">BLUE</a>,<a class="code" href="colors_8h.html#a79d10e672abb49ad63eeaa8aaef57c38">BLUE</a>);
<a name="l00069"></a>00069         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(value, <span class="stringliteral">&quot;green&quot;</span>) == 0 )
<a name="l00070"></a>00070                 *color = <a class="code" href="colors_8h.html#a587223a5cf6a783335c29a47bec92155">setColor</a>(<a class="code" href="colors_8h.html#acfbc006ea433ad708fdee3e82996e721">GREEN</a>,<a class="code" href="colors_8h.html#acfbc006ea433ad708fdee3e82996e721">GREEN</a>);
<a name="l00071"></a>00071         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(value, <span class="stringliteral">&quot;cyan&quot;</span>) == 0 )
<a name="l00072"></a>00072                 *color = <a class="code" href="colors_8h.html#a587223a5cf6a783335c29a47bec92155">setColor</a>(<a class="code" href="colors_8h.html#ad243f93c16bc4c1d3e0a13b84421d760">CYAN</a>,<a class="code" href="colors_8h.html#ad243f93c16bc4c1d3e0a13b84421d760">CYAN</a>);
<a name="l00073"></a>00073         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(value, <span class="stringliteral">&quot;red&quot;</span>) == 0 )
<a name="l00074"></a>00074                 *color = <a class="code" href="colors_8h.html#a587223a5cf6a783335c29a47bec92155">setColor</a>(<a class="code" href="colors_8h.html#a8d23feea868a983c8c2b661e1e16972f">RED</a>,<a class="code" href="colors_8h.html#a8d23feea868a983c8c2b661e1e16972f">RED</a>);
<a name="l00075"></a>00075         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(value, <span class="stringliteral">&quot;magenta&quot;</span>) == 0 )
<a name="l00076"></a>00076                 *color = <a class="code" href="colors_8h.html#a587223a5cf6a783335c29a47bec92155">setColor</a>(<a class="code" href="colors_8h.html#a6f699060902f800f12aaae150f3a708e">MAGENTA</a>,<a class="code" href="colors_8h.html#a6f699060902f800f12aaae150f3a708e">MAGENTA</a>);
<a name="l00077"></a>00077         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(value, <span class="stringliteral">&quot;brown&quot;</span>) == 0 )
<a name="l00078"></a>00078                 *color = <a class="code" href="colors_8h.html#a587223a5cf6a783335c29a47bec92155">setColor</a>(<a class="code" href="colors_8h.html#ab2baea56ece91306020afd6d77fd19f9">BROWN</a>,<a class="code" href="colors_8h.html#ab2baea56ece91306020afd6d77fd19f9">BROWN</a>);
<a name="l00079"></a>00079         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(value, <span class="stringliteral">&quot;white&quot;</span>) == 0 )
<a name="l00080"></a>00080                 *color = <a class="code" href="colors_8h.html#a587223a5cf6a783335c29a47bec92155">setColor</a>(<a class="code" href="colors_8h.html#a87b537f5fa5c109d3c05c13d6b18f382">WHITE</a>,<a class="code" href="colors_8h.html#a87b537f5fa5c109d3c05c13d6b18f382">WHITE</a>);
<a name="l00081"></a>00081         <span class="keywordflow">else</span>
<a name="l00082"></a>00082                 <span class="keywordflow">return</span> 0;
<a name="l00083"></a>00083         <span class="keywordflow">return</span> 1;
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="keyword">static</span> <span class="keywordtype">int</span> videoColor ( <span class="keywordtype">char</span> * value )
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088         <span class="keywordtype">int</span> color;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090         <span class="keywordflow">if</span> ( getColor(value, &amp;color) )
<a name="l00091"></a>00091         {
<a name="l00092"></a>00092                 color &amp;= 0xF;
<a name="l00093"></a>00093                 <span class="comment">/*setPointerVisibility(0);*/</span>
<a name="l00094"></a>00094                 <a class="code" href="video__driver_8h.html#a3492ebc2f3dbfe60af5c8aac3d49bf6a" title="Set the default video color.">setVideoColor</a>(color);
<a name="l00095"></a>00095                 <a class="code" href="video__driver_8h.html#a62a7e9a63ed5e7629312b9cd1599d0f1" title="Updates the hole screen with actual video color all colors will be changed.">updateColor</a>();
<a name="l00096"></a>00096                 <a class="code" href="video__driver_8h.html#ab59b086c41d506e55aa02729f9916be2" title="Updates all changes made to video buffer into screen.">refreshScreen</a>();
<a name="l00097"></a>00097                 <span class="comment">/*setPointerVisibility(1);*/</span>
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099         <span class="keywordflow">else</span>
<a name="l00100"></a>00100         {
<a name="l00101"></a>00101                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Error: Invalid Color - &quot;</span>);
<a name="l00102"></a>00102                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(value);
<a name="l00103"></a>00103                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l00104"></a>00104                 <span class="keywordflow">return</span> 0;
<a name="l00105"></a>00105         }
<a name="l00106"></a>00106         <span class="keywordflow">return</span> 1;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="keyword">static</span> <span class="keywordtype">int</span> tabStop (<span class="keywordtype">char</span> * value)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111         <span class="keywordtype">int</span> ts = <a class="code" href="string_8h.html#a499020e544a321bb07fd3cb85102db46" title="Transforms the given string to an int.">toInt</a>(value);
<a name="l00112"></a>00112         <span class="keywordflow">if</span> ( <a class="code" href="video__driver_8h.html#a97b4260d4d44d5b3742300605cd4d6ea" title="Sets the video tab stop.">setVideoTabStop</a>(ts) != ts )
<a name="l00113"></a>00113         {
<a name="l00114"></a>00114                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Error: Invalid value - &quot;</span>);
<a name="l00115"></a>00115                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(value);
<a name="l00116"></a>00116                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l00117"></a>00117                 <span class="keywordflow">return</span> 0;
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119         <span class="keywordflow">return</span> 1;
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="keyword">static</span> <a class="code" href="structproperty_t.html" title="The property struct.">propertyT</a> properties[] = {
<a name="l00123"></a>00123         {<span class="stringliteral">&quot;video-color&quot;</span>, videoColor, <span class="stringliteral">&quot;Changes the video color. Valid colors: BLUE, GREEN, CYAN, RED and MAGENTA.&quot;</span>},
<a name="l00124"></a>00124         {<span class="stringliteral">&quot;tab-stop&quot;</span>, tabStop, <span class="stringliteral">&quot;Changes amount of spaces a tab stop inserts into a line.&quot;</span>},
<a name="l00125"></a>00125         {<span class="stringliteral">&quot;&quot;</span>, <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>}
<a name="l00126"></a>00126 };
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <span class="keyword">static</span> <span class="keywordtype">int</span> setProperty(<span class="keywordtype">char</span> *property, <span class="keywordtype">char</span> *value)
<a name="l00129"></a>00129 {
<a name="l00130"></a>00130         <span class="keywordtype">int</span> i;
<a name="l00131"></a>00131         
<a name="l00132"></a>00132         <span class="keywordflow">for</span> ( i = 0; properties[i].<a class="code" href="structproperty_t.html#a6e26a6bc52b703ab5ccbce61991bf447">func</a> != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>; ++i )
<a name="l00133"></a>00133                 <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(properties[i].name, property) == 0 )
<a name="l00134"></a>00134                         <span class="keywordflow">return</span> properties[i].<a class="code" href="structproperty_t.html#a6e26a6bc52b703ab5ccbce61991bf447">func</a>(value);
<a name="l00135"></a>00135         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Error: Invalid property - &quot;</span>);
<a name="l00136"></a>00136         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(property);
<a name="l00137"></a>00137         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l00138"></a>00138         <span class="keywordflow">return</span> 0;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="keyword">static</span> <span class="keywordtype">void</span> printProperties ( <span class="keywordtype">char</span> *value )
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143         <span class="keywordtype">int</span> i;
<a name="l00144"></a>00144         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;System Properties:\n&quot;</span>);
<a name="l00145"></a>00145         <span class="keywordflow">for</span> ( i = 0; properties[i].<a class="code" href="structproperty_t.html#a6e26a6bc52b703ab5ccbce61991bf447">func</a> != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>; ++i )
<a name="l00146"></a>00146         {
<a name="l00147"></a>00147                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;\t - &quot;</span>);
<a name="l00148"></a>00148                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(properties[i].name);
<a name="l00149"></a>00149                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;: &quot;</span>);
<a name="l00150"></a>00150                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(properties[i].helpMsg);
<a name="l00151"></a>00151                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="comment">/* END SYSTEM PROPERTIES */</span>
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="keyword">static</span> <a class="code" href="structcommand_t.html" title="The command struct.">commandT</a> * getCommand ( <span class="keywordtype">char</span> * command );
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <span class="comment">/* SHELL COMMANDS */</span>
<a name="l00160"></a>00160 <span class="keyword">static</span> <span class="keywordtype">void</span> clear(<span class="keywordtype">char</span> *);
<a name="l00161"></a>00161 <span class="keyword">static</span> <span class="keywordtype">void</span> echo(<span class="keywordtype">char</span> *);
<a name="l00162"></a>00162 <span class="keyword">static</span> <span class="keywordtype">void</span> logout(<span class="keywordtype">char</span> *);
<a name="l00163"></a>00163 <span class="keyword">static</span> <span class="keywordtype">void</span> help(<span class="keywordtype">char</span> *);
<a name="l00164"></a>00164 <span class="keyword">static</span> <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">char</span> *);
<a name="l00165"></a>00165 <span class="keyword">static</span> <span class="keywordtype">void</span> reboot(<span class="keywordtype">char</span> *);
<a name="l00166"></a>00166 <span class="keyword">static</span> <span class="keywordtype">void</span> shutdown(<span class="keywordtype">char</span> *);
<a name="l00167"></a>00167 <span class="keyword">static</span> <span class="keywordtype">void</span> mkdir(<span class="keywordtype">char</span> *);
<a name="l00168"></a>00168 <span class="keyword">static</span> <span class="keywordtype">void</span> printPhrasing(<span class="keywordtype">char</span> *);
<a name="l00169"></a>00169 <span class="keyword">static</span> <span class="keywordtype">void</span> startTop(<span class="keywordtype">char</span> *);
<a name="l00170"></a>00170 <span class="keyword">static</span> <span class="keywordtype">void</span> startKill(<span class="keywordtype">char</span> *);
<a name="l00171"></a>00171 <span class="keyword">static</span> <span class="keywordtype">void</span> startPrintA(<span class="keywordtype">char</span> *);
<a name="l00172"></a>00172 <span class="keyword">static</span> <span class="keywordtype">void</span> startPrintB(<span class="keywordtype">char</span> *);
<a name="l00173"></a>00173 <span class="keyword">static</span> <span class="keywordtype">void</span> startNothing(<span class="keywordtype">char</span> *);
<a name="l00174"></a>00174 <span class="keyword">static</span> <span class="keywordtype">void</span> startPageFault(<span class="keywordtype">char</span> *);
<a name="l00175"></a>00175 <span class="keyword">static</span> <span class="keywordtype">void</span> changeSchedule( <span class="keywordtype">char</span> *);
<a name="l00176"></a>00176 <span class="keyword">static</span> <span class="keywordtype">void</span> startBattleShip(<span class="keywordtype">char</span> *args);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="keyword">static</span> <a class="code" href="structcommand_t.html" title="The command struct.">commandT</a> commands[] = {
<a name="l00179"></a>00179         {<span class="stringliteral">&quot;clear&quot;</span>, clear, <span class="stringliteral">&quot;Clears Screen.&quot;</span>},
<a name="l00180"></a>00180         {<span class="stringliteral">&quot;echo&quot;</span>, echo, <span class="stringliteral">&quot;Prints the arguments on the standard output.&quot;</span>},
<a name="l00181"></a>00181         {<span class="stringliteral">&quot;logout&quot;</span>, logout, <span class="stringliteral">&quot;Terminates the shell application.&quot;</span>},
<a name="l00182"></a>00182         {<span class="stringliteral">&quot;help&quot;</span>, help, <span class="stringliteral">&quot;Prints this list of commands.&quot;</span>},
<a name="l00183"></a>00183         {<span class="stringliteral">&quot;set&quot;</span>, <span class="keyword">set</span>, <span class="stringliteral">&quot;Sets a system property. Use: set property=value.&quot;</span>},
<a name="l00184"></a>00184         {<span class="stringliteral">&quot;reboot&quot;</span>, reboot, <span class="stringliteral">&quot;Reboots the system.&quot;</span>},
<a name="l00185"></a>00185         {<span class="stringliteral">&quot;shutdown&quot;</span>, shutdown, <span class="stringliteral">&quot;Shuts the system down.&quot;</span>},
<a name="l00186"></a>00186         {<span class="stringliteral">&quot;mkdir&quot;</span>, mkdir, <span class="stringliteral">&quot;Makes a new directory.&quot;</span>},
<a name="l00187"></a>00187         {<span class="stringliteral">&quot;print-sysproperties&quot;</span>, printProperties, <span class="stringliteral">&quot;Prints the lisf of system properties that can be set by the set command.&quot;</span>},
<a name="l00188"></a>00188         {<span class="stringliteral">&quot;print-statement&quot;</span>, printPhrasing, <span class="stringliteral">&quot;Prints the statment of the project.&quot;</span>},
<a name="l00189"></a>00189         {<span class="stringliteral">&quot;top&quot;</span>, startTop, <span class="stringliteral">&quot;Runs the top process.&quot;</span>},
<a name="l00190"></a>00190         {<span class="stringliteral">&quot;kill&quot;</span>,startKill, <span class="stringliteral">&quot;Takes the pid of the standar input, and Kill the process associated.&quot;</span>},
<a name="l00191"></a>00191         {<span class="stringliteral">&quot;printA&quot;</span>, startPrintA, <span class="stringliteral">&quot;Prints &#39;A&#39; in the stdout, could be running in background.&quot;</span>},
<a name="l00192"></a>00192         {<span class="stringliteral">&quot;printB&quot;</span>, startPrintB, <span class="stringliteral">&quot;Prints &#39;B&#39; in the stdout, could be running in background.&quot;</span>},
<a name="l00193"></a>00193         {<span class="stringliteral">&quot;nothing&quot;</span>, startNothing, <span class="stringliteral">&quot;An idle process, could be running in background.&quot;</span>},
<a name="l00194"></a>00194         {<span class="stringliteral">&quot;pageFault&quot;</span>, startPageFault, <span class="stringliteral">&quot;Force a page fault exception.&quot;</span>},
<a name="l00195"></a>00195         {<span class="stringliteral">&quot;scheduling&quot;</span>, changeSchedule, <span class="stringliteral">&quot;Change the Schedule Algorithm, if it&#39;s running Round Robin, it changes to RPG and viceversa&quot;</span>},
<a name="l00196"></a>00196         {<span class="stringliteral">&quot;battleship&quot;</span>, startBattleShip, <span class="stringliteral">&quot;Starts Battleship&quot;</span>},
<a name="l00197"></a>00197         {<span class="stringliteral">&quot;&quot;</span>, <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>, <span class="stringliteral">&quot;&quot;</span>}
<a name="l00198"></a>00198 };
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="keyword">static</span> <span class="keywordtype">void</span> printPhrasing(<span class="keywordtype">char</span> * value)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202         <span class="keyword">static</span> <span class="keywordtype">char</span> * msg1 = <span class="stringliteral">&quot;\nObjetivo\n\tRealizar un programa que muestre algunas de las caracteristicas del Modo protegido de los microprocesadores de Intel.\n\tEnunciado\n\tEl trabajo consta de un diskete booteable con GRUB instalado, el cual debe obtener de disco una imagen binaria que sera el programa que corra en Modo protegido.\n\tDicho programa debera contener lo siguiente:\n\t\ta) Shell: El sistema debe proveer al usuario de un shell, para poder ejecutar comandos.\n\t\tb) INT 80h: Crear las primitivas read() y write() &quot;</span>;
<a name="l00203"></a>00203         <span class="keyword">static</span> <span class="keywordtype">char</span> * msg2 = <span class="stringliteral">&quot;para centralizar la lectura y la escritura de los dispositivos. Dichas primitivas deben invocar la INT 80h.\n\t\tc) Driver de Mouse: El programa debera poder manejar un cursor de texto en pantalla. Con el botón izquierdo del Mouse presionado se podra seleccionar cualquier parte de la pantalla (copiar) y con el boton derecho &quot;</span>;
<a name="l00204"></a>00204         <span class="keyword">static</span> <span class="keywordtype">char</span> * msg3 = <span class="stringliteral">&quot;se podra “pegar” lo seleccionado donde se encuentre el cursor para ingreso de datos.\n\t\td) Salva pantalla: Por línea de comando se podra programar la cantidad de segundos en la que se activa el salva pantalla. El mismo dejara de funcionar ante la presión de una tecla o el movimiento del Mouse.\n\n&quot;</span>;
<a name="l00205"></a>00205         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(msg1);
<a name="l00206"></a>00206         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(msg2);
<a name="l00207"></a>00207         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(msg3);
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="keyword">static</span> <span class="keywordtype">void</span> mkdir(<span class="keywordtype">char</span> *value)
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;jejejeje...are you crazy!!!???\n&quot;</span>);
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="keyword">static</span> <span class="keywordtype">void</span> shutdown(<span class="keywordtype">char</span> *value)
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Shutting down the system...\n&quot;</span>);
<a name="l00218"></a>00218         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;...oops!!! function not implemented...Push the power button.\n&quot;</span>);
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="keyword">static</span> <span class="keywordtype">void</span> reboot(<span class="keywordtype">char</span> *value)
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223         <a class="code" href="system_8h.html#ac8c8545f4a29ebb7d3e384467263cf50" title="Reboots the system.">rebootSystem</a>();
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="keyword">static</span> <span class="keywordtype">void</span> clear ( <span class="keywordtype">char</span> * args )
<a name="l00227"></a>00227 {
<a name="l00228"></a>00228         <a class="code" href="ttys_8h.html#a6083aac7b79f2adcd3c4d6fbf479f283" title="It clears the stdout of the tty that is in focus.">clearTTYScreen</a>();
<a name="l00229"></a>00229         <a class="code" href="ttys_8h.html#a77495bf57af4fe0554f55dc4be4a4600" title="It sets the cursor in an specific position of the tty stdout.">setTTYCursorPosition</a>(0, 0);
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="keyword">static</span> <span class="keywordtype">void</span> echo ( <span class="keywordtype">char</span> * args )
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(args);
<a name="l00235"></a>00235         <a class="code" href="stdio_8h.html#a568f021a83b2c22e1e700d12559d660a" title="putchar function define.">putchar</a>(<span class="charliteral">&#39;\n&#39;</span>);
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="keywordtype">void</span> logout ( <span class="keywordtype">char</span> * args )
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240         <span class="keywordtype">int</span> indexDT;
<a name="l00241"></a>00241         
<a name="l00242"></a>00242         indexDT = getGlobalDataIndex(); 
<a name="l00243"></a>00243         <span class="keywordflow">if</span>(indexDT == -1){
<a name="l00244"></a>00244                 <span class="comment">/*el pid ingresado no es valido hay que salir con error*/</span>
<a name="l00245"></a>00245                 <span class="keywordflow">return</span>;
<a name="l00246"></a>00246         }
<a name="l00247"></a>00247         
<a name="l00248"></a>00248         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;[logout]\n&quot;</span>);
<a name="l00249"></a>00249         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Exiting Shell...\n&quot;</span>);
<a name="l00250"></a>00250         tableDataShell[indexDT].<a class="code" href="structdata_slot_shell.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="types_8h.html#a94b1da2e055fff4d143aa6aa891f79a9a11fd9ca455f92c69c084484d5cd803c2">DEAD</a>;
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 <span class="keyword">static</span> <span class="keywordtype">void</span> help ( <span class="keywordtype">char</span> * args )
<a name="l00254"></a>00254 {
<a name="l00255"></a>00255         <span class="keywordtype">int</span> i;
<a name="l00256"></a>00256         <span class="keywordtype">char</span> * command;
<a name="l00257"></a>00257         <a class="code" href="structcommand_t.html" title="The command struct.">commandT</a> * cmd;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         <span class="keywordflow">if</span> ( (command = <a class="code" href="string_8h.html#a623f10afaacb826c45536f4191c18357" title="Gets segments of the given string delimitated by the given tokens.">strtok</a>(args, <span class="stringliteral">&quot; &quot;</span>)) == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a> )
<a name="l00260"></a>00260         {
<a name="l00261"></a>00261                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Command list:\n&quot;</span>);
<a name="l00262"></a>00262                 <span class="keywordflow">for</span> ( i = 0; commands[i].<a class="code" href="structcommand_t.html#aaadded894dece7b4c2b3d51d18ada303">func</a> != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>; ++i )
<a name="l00263"></a>00263                 {
<a name="l00264"></a>00264                         <a class="code" href="stdio_8h.html#a568f021a83b2c22e1e700d12559d660a" title="putchar function define.">putchar</a>(<span class="charliteral">&#39;\t&#39;</span>);
<a name="l00265"></a>00265                         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(commands[i].command);
<a name="l00266"></a>00266                         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot; - &quot;</span>);
<a name="l00267"></a>00267                         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(commands[i].helpMsg);
<a name="l00268"></a>00268                         <a class="code" href="stdio_8h.html#a568f021a83b2c22e1e700d12559d660a" title="putchar function define.">putchar</a>(<span class="charliteral">&#39;\n&#39;</span>);
<a name="l00269"></a>00269                 }
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (cmd = getCommand(command)) != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a> ) 
<a name="l00272"></a>00272         {
<a name="l00273"></a>00273                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(command);
<a name="l00274"></a>00274                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;: &quot;</span>);
<a name="l00275"></a>00275                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(cmd-&gt;<a class="code" href="structcommand_t.html#aecae62b0d3cecad6022e749f64cc8a8e">helpMsg</a>);
<a name="l00276"></a>00276                 <a class="code" href="stdio_8h.html#a568f021a83b2c22e1e700d12559d660a" title="putchar function define.">putchar</a>(<span class="charliteral">&#39;\n&#39;</span>);
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278         <span class="keywordflow">else</span>
<a name="l00279"></a>00279                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Command not found\n&quot;</span>);
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="keyword">static</span> <span class="keywordtype">void</span> <span class="keyword">set</span> ( <span class="keywordtype">char</span> * args )
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284         <span class="keywordtype">char</span> * property, * value;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="keywordflow">if</span> ( (property = <a class="code" href="string_8h.html#a623f10afaacb826c45536f4191c18357" title="Gets segments of the given string delimitated by the given tokens.">strtok</a>(args, <span class="stringliteral">&quot;=&quot;</span>)) == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a> )
<a name="l00287"></a>00287         {
<a name="l00288"></a>00288                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Error: Invalid System Property\n&quot;</span>);
<a name="l00289"></a>00289                 <span class="keywordflow">return</span>;
<a name="l00290"></a>00290         }
<a name="l00291"></a>00291         <span class="keywordflow">if</span> ( (value = <a class="code" href="string_8h.html#a623f10afaacb826c45536f4191c18357" title="Gets segments of the given string delimitated by the given tokens.">strtok</a>(<a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>, <span class="stringliteral">&quot;=&quot;</span>)) == <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a> )
<a name="l00292"></a>00292         {
<a name="l00293"></a>00293                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Error: Invalid Property Value\n&quot;</span>);
<a name="l00294"></a>00294                 <span class="keywordflow">return</span>;
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296         setProperty(property, value);
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 <span class="keyword">static</span> <span class="keywordtype">void</span> startTop(<span class="keywordtype">char</span> *args){
<a name="l00300"></a>00300         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid, ownPid;
<a name="l00301"></a>00301         <span class="keywordtype">int</span> i;
<a name="l00302"></a>00302         <span class="keywordtype">int</span> status;
<a name="l00303"></a>00303         <a class="code" href="structprocess__t.html" title="The process struct.">process_t</a> *<a class="code" href="bin_8c.html#a83e1a7341d63e92cd3d1733f87176a88">processTable</a>;
<a name="l00304"></a>00304         
<a name="l00305"></a>00305         ownPid = <a class="code" href="process_8h.html#ac61b207337ca21b3b309593fd1a0cb82" title="Retrieves the calling process&amp;#39; pid.">getpid</a>();
<a name="l00306"></a>00306         processTable = <a class="code" href="sys_process_8h.html#aa1cd2078219adc47ca22033bf86a76be" title="Retrieves the OS process table.">getProcessTable</a>();
<a name="l00307"></a>00307         
<a name="l00308"></a>00308         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a7ae1ae649327b67ce210e47ea1ed07dc" title="DefineBrief.">ATOMIC</a>);
<a name="l00309"></a>00309         
<a name="l00310"></a>00310         <span class="keywordflow">for</span> (i = 0 ; i &lt; <a class="code" href="config_8h.html#ad4c770f8a29f82d705f3d34839112bd1" title="The maximum amount of process.">MAX_PROCESS</a> ; ++i){
<a name="l00311"></a>00311                 <span class="keywordflow">if</span> (!<a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(processTable[i].name, <span class="stringliteral">&quot;top&quot;</span>) &amp;&amp; processTable[i].pid &gt; 0){
<a name="l00312"></a>00312                         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;El proceso top ya se encuentra corriendo en la tty &quot;</span>);
<a name="l00313"></a>00313                         <a class="code" href="stdio_8h.html#a049d7c6dddcd2eafdf1349942dbdac88" title="puti function define.">puti</a>(processTable[i].tty + 1);
<a name="l00314"></a>00314                         <a class="code" href="stdio_8h.html#a568f021a83b2c22e1e700d12559d660a" title="putchar function define.">putchar</a>(<span class="charliteral">&#39;\n&#39;</span>);
<a name="l00315"></a>00315                         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a33d80cf420a3739faa00760673eee7db" title="DefineBrief.">UNATOMIC</a>);
<a name="l00316"></a>00316                         <span class="keywordflow">return</span>;
<a name="l00317"></a>00317                 }
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319         
<a name="l00320"></a>00320         <span class="keywordflow">if</span> ((pid = <a class="code" href="process_8h.html#a400d6ff57b24d5bec48a1a28ad944081" title="Creates a new process into the system and sets it ready to run. The process will...">createProcess</a>(<span class="stringliteral">&quot;top&quot;</span>, (<span class="keywordtype">void</span>(*)(<span class="keywordtype">void</span> *))<a class="code" href="bin_8h.html#a9795fbee9531f56aeda1376bf9934506" title="This function show what percentage of the microprocessor it is using each process...">top</a>, <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>, <a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>)) == -1 ) {
<a name="l00321"></a>00321                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;ERROR: Top could not be created.\n&quot;</span>);
<a name="l00322"></a>00322         }
<a name="l00323"></a>00323         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a33d80cf420a3739faa00760673eee7db" title="DefineBrief.">UNATOMIC</a>);
<a name="l00324"></a>00324         <a class="code" href="process_8h.html#a750680863e18ddefd3f3eae7d04cbe96" title="This function blocks the calling process until the given pid child returns.">waitpid</a>(pid, &amp;status);
<a name="l00325"></a>00325         <a class="code" href="ttys_8h.html#a6083aac7b79f2adcd3c4d6fbf479f283" title="It clears the stdout of the tty that is in focus.">clearTTYScreen</a>();
<a name="l00326"></a>00326         
<a name="l00327"></a>00327         <span class="keywordflow">return</span>;         
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="keyword">static</span> <span class="keywordtype">void</span> startKill(<span class="keywordtype">char</span> *args){
<a name="l00331"></a>00331         <span class="keywordtype">int</span> pid;
<a name="l00332"></a>00332         
<a name="l00333"></a>00333         pid = <a class="code" href="string_8h.html#a499020e544a321bb07fd3cb85102db46" title="Transforms the given string to an int.">toInt</a>(args);      
<a name="l00334"></a>00334         <span class="keywordflow">if</span> (<a class="code" href="process_8h.html#a650cf0caaaa8b75f653c1c92818d03a4" title="Kills the given pid process.">kill</a>((<a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a>)pid) == 0){
<a name="l00335"></a>00335                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Killing process &quot;</span>);
<a name="l00336"></a>00336                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<a class="code" href="sys_process_8h.html#aa1cd2078219adc47ca22033bf86a76be" title="Retrieves the OS process table.">getProcessTable</a>()[pid].name);
<a name="l00337"></a>00337                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;...\n&quot;</span>);
<a name="l00338"></a>00338         }
<a name="l00339"></a>00339         <span class="keywordflow">else</span>
<a name="l00340"></a>00340                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;No process for the given pid\n&quot;</span>);
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 <span class="keyword">static</span> <span class="keywordtype">void</span> startBattleShip(<span class="keywordtype">char</span> *args){
<a name="l00344"></a>00344         <span class="keywordtype">int</span> status;
<a name="l00345"></a>00345         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid, ownPid;
<a name="l00346"></a>00346         
<a name="l00347"></a>00347         ownPid = <a class="code" href="process_8h.html#ac61b207337ca21b3b309593fd1a0cb82" title="Retrieves the calling process&amp;#39; pid.">getpid</a>();
<a name="l00348"></a>00348         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a7ae1ae649327b67ce210e47ea1ed07dc" title="DefineBrief.">ATOMIC</a>);
<a name="l00349"></a>00349         
<a name="l00350"></a>00350         <span class="keywordflow">if</span> ((pid = <a class="code" href="process_8h.html#a400d6ff57b24d5bec48a1a28ad944081" title="Creates a new process into the system and sets it ready to run. The process will...">createProcess</a>(<span class="stringliteral">&quot;battleship&quot;</span>, (<span class="keywordtype">void</span>(*)(<span class="keywordtype">void</span> *))<a class="code" href="bttlship_8h.html#a52e47768a66b91e89d5546a8cb0f168c" title="It&amp;#39;s the main process of the battleship, it generates the whole table and ships...">battleship</a>, <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>, <a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>)) == -1 ) {
<a name="l00351"></a>00351                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;ERROR: Battleship could not be created.\n&quot;</span>);
<a name="l00352"></a>00352         }
<a name="l00353"></a>00353         <a class="code" href="process_8h.html#a8984ed6d44c45fc3a93b0c8fd217fab4" title="Sets the pid process priority.">setPriority</a>(pid, 4);
<a name="l00354"></a>00354         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a33d80cf420a3739faa00760673eee7db" title="DefineBrief.">UNATOMIC</a>);
<a name="l00355"></a>00355         <a class="code" href="process_8h.html#a750680863e18ddefd3f3eae7d04cbe96" title="This function blocks the calling process until the given pid child returns.">waitpid</a>(pid, &amp;status);
<a name="l00356"></a>00356         <span class="comment">//clearTTYScreen();</span>
<a name="l00357"></a>00357         
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 <span class="keyword">static</span> <span class="keywordtype">void</span> startPrintA(<span class="keywordtype">char</span> *args){
<a name="l00361"></a>00361         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid, ownPid;
<a name="l00362"></a>00362         <span class="keywordtype">int</span> status;
<a name="l00363"></a>00363         <span class="keywordtype">int</span> mode;
<a name="l00364"></a>00364         
<a name="l00365"></a>00365         ownPid = <a class="code" href="process_8h.html#ac61b207337ca21b3b309593fd1a0cb82" title="Retrieves the calling process&amp;#39; pid.">getpid</a>();
<a name="l00366"></a>00366         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a7ae1ae649327b67ce210e47ea1ed07dc" title="DefineBrief.">ATOMIC</a>);
<a name="l00367"></a>00367         mode = *args ==<span class="charliteral">&#39;&amp;&#39;</span> ? <a class="code" href="defs_8h.html#a850b2f07a67b73890889e63fb8a49fda" title="DefineBrief.">BACKGROUND</a>:<a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>;
<a name="l00368"></a>00368         
<a name="l00369"></a>00369         <span class="keywordflow">if</span> ((pid = <a class="code" href="process_8h.html#a400d6ff57b24d5bec48a1a28ad944081" title="Creates a new process into the system and sets it ready to run. The process will...">createProcess</a>(<span class="stringliteral">&quot;printA&quot;</span>, (<span class="keywordtype">void</span>(*)(<span class="keywordtype">void</span> *))<a class="code" href="bin_8h.html#a8d6f8ce896cba69a844650449479ead1" title="This function prints infinite A letters.">printA</a>, <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>, mode)) == -1 ) {
<a name="l00370"></a>00370                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;ERROR: printA could not be created.\n&quot;</span>);
<a name="l00371"></a>00371         }
<a name="l00372"></a>00372         <a class="code" href="process_8h.html#a8984ed6d44c45fc3a93b0c8fd217fab4" title="Sets the pid process priority.">setPriority</a>(pid, 4);
<a name="l00373"></a>00373         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a33d80cf420a3739faa00760673eee7db" title="DefineBrief.">UNATOMIC</a>);
<a name="l00374"></a>00374         <span class="keywordflow">if</span>(mode == <a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>){
<a name="l00375"></a>00375                 <a class="code" href="process_8h.html#a750680863e18ddefd3f3eae7d04cbe96" title="This function blocks the calling process until the given pid child returns.">waitpid</a>(pid, &amp;status);
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377         <span class="keywordflow">return</span>;
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 <span class="keyword">static</span> <span class="keywordtype">void</span> startPrintB(<span class="keywordtype">char</span> *args){
<a name="l00381"></a>00381         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid, ownPid;
<a name="l00382"></a>00382         <span class="keywordtype">int</span> status;
<a name="l00383"></a>00383         <span class="keywordtype">int</span> mode;
<a name="l00384"></a>00384         
<a name="l00385"></a>00385         ownPid = <a class="code" href="process_8h.html#ac61b207337ca21b3b309593fd1a0cb82" title="Retrieves the calling process&amp;#39; pid.">getpid</a>();
<a name="l00386"></a>00386         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a7ae1ae649327b67ce210e47ea1ed07dc" title="DefineBrief.">ATOMIC</a>);
<a name="l00387"></a>00387         mode = *args ==<span class="charliteral">&#39;&amp;&#39;</span> ? <a class="code" href="defs_8h.html#a850b2f07a67b73890889e63fb8a49fda" title="DefineBrief.">BACKGROUND</a>:<a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>;
<a name="l00388"></a>00388         
<a name="l00389"></a>00389         <span class="keywordflow">if</span> ((pid = <a class="code" href="process_8h.html#a400d6ff57b24d5bec48a1a28ad944081" title="Creates a new process into the system and sets it ready to run. The process will...">createProcess</a>(<span class="stringliteral">&quot;printB&quot;</span>, (<span class="keywordtype">void</span>(*)(<span class="keywordtype">void</span> *))<a class="code" href="bin_8h.html#a5964c5b2b75cb7dc3c7648afe535fd03" title="This functions prints infinite A letters.">printB</a>, <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>, mode)) == -1 ) {
<a name="l00390"></a>00390                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;ERROR: printB could not be created.\n&quot;</span>);
<a name="l00391"></a>00391         }
<a name="l00392"></a>00392         <a class="code" href="process_8h.html#a8984ed6d44c45fc3a93b0c8fd217fab4" title="Sets the pid process priority.">setPriority</a>(pid, 2);
<a name="l00393"></a>00393         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a33d80cf420a3739faa00760673eee7db" title="DefineBrief.">UNATOMIC</a>);
<a name="l00394"></a>00394         <span class="keywordflow">if</span>(mode == <a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>){
<a name="l00395"></a>00395                 <a class="code" href="process_8h.html#a750680863e18ddefd3f3eae7d04cbe96" title="This function blocks the calling process until the given pid child returns.">waitpid</a>(pid, &amp;status);
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397         <span class="keywordflow">return</span>;
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="keyword">static</span> <span class="keywordtype">void</span> startNothing(<span class="keywordtype">char</span> *args){
<a name="l00401"></a>00401         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid, ownPid;
<a name="l00402"></a>00402         <span class="keywordtype">int</span> status;
<a name="l00403"></a>00403         <span class="keywordtype">int</span> mode;
<a name="l00404"></a>00404         
<a name="l00405"></a>00405         mode = (*args == <span class="charliteral">&#39;&amp;&#39;</span>) ? <a class="code" href="defs_8h.html#a850b2f07a67b73890889e63fb8a49fda" title="DefineBrief.">BACKGROUND</a> : <a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>;
<a name="l00406"></a>00406         ownPid = <a class="code" href="process_8h.html#ac61b207337ca21b3b309593fd1a0cb82" title="Retrieves the calling process&amp;#39; pid.">getpid</a>();
<a name="l00407"></a>00407         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a7ae1ae649327b67ce210e47ea1ed07dc" title="DefineBrief.">ATOMIC</a>);
<a name="l00408"></a>00408         
<a name="l00409"></a>00409         <span class="keywordflow">if</span> ((pid = <a class="code" href="process_8h.html#a400d6ff57b24d5bec48a1a28ad944081" title="Creates a new process into the system and sets it ready to run. The process will...">createProcess</a>(<span class="stringliteral">&quot;nothing&quot;</span>, (<span class="keywordtype">void</span>(*)(<span class="keywordtype">void</span> *))<a class="code" href="bin_8h.html#a91d6348b48c15f044abee99da6fec6bd" title="This function only consumes the microprocessor.">nothing</a>, <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>, mode)) == -1 ) {
<a name="l00410"></a>00410                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;ERROR: nothing could not be created.\n&quot;</span>);
<a name="l00411"></a>00411         }
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (mode == <a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>){
<a name="l00413"></a>00413                 <a class="code" href="process_8h.html#aa4f3855e8a226d285a523789a377fe04" title="Sets the tty mode of the given pid process.">setTTYMode</a>(pid, <a class="code" href="defs_8h.html#afd70646efe5984e361c17010322a5711" title="DefineBrief.">TTY_CANONICAL</a>);
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(ownPid, <a class="code" href="defs_8h.html#a33d80cf420a3739faa00760673eee7db" title="DefineBrief.">UNATOMIC</a>);
<a name="l00416"></a>00416         
<a name="l00417"></a>00417         
<a name="l00418"></a>00418         <span class="keywordflow">if</span>(mode == <a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>){
<a name="l00419"></a>00419                 <a class="code" href="process_8h.html#a750680863e18ddefd3f3eae7d04cbe96" title="This function blocks the calling process until the given pid child returns.">waitpid</a>(pid, &amp;status);
<a name="l00420"></a>00420         }
<a name="l00421"></a>00421         <span class="keywordflow">return</span>;
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="keyword">static</span> <span class="keywordtype">void</span> startPageFault(<span class="keywordtype">char</span> *args){
<a name="l00425"></a>00425         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid;
<a name="l00426"></a>00426         <span class="keywordtype">int</span> status;
<a name="l00427"></a>00427         
<a name="l00428"></a>00428         <span class="keywordflow">if</span> ((pid = <a class="code" href="process_8h.html#a400d6ff57b24d5bec48a1a28ad944081" title="Creates a new process into the system and sets it ready to run. The process will...">createProcess</a>(<span class="stringliteral">&quot;nothing&quot;</span>, (<span class="keywordtype">void</span>(*)(<span class="keywordtype">void</span> *))<a class="code" href="bin_8h.html#ab8d39c86e0f803f0816e787e36c99bd1" title="This function generates a page fault exception.">pageFault</a>, <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>, <a class="code" href="defs_8h.html#a2a375179c125d0867430c6778c343b6f" title="DefineBrief.">FOREGROUND</a>)) == -1 ) {
<a name="l00429"></a>00429                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;ERROR: nothing could not be created.\n&quot;</span>);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431         <a class="code" href="process_8h.html#a750680863e18ddefd3f3eae7d04cbe96" title="This function blocks the calling process until the given pid child returns.">waitpid</a>(pid, &amp;status);
<a name="l00432"></a>00432 
<a name="l00433"></a>00433         <span class="keywordflow">return</span>;
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="keyword">static</span> <span class="keywordtype">void</span> changeSchedule( <span class="keywordtype">char</span> * args ){
<a name="l00437"></a>00437         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid;
<a name="l00438"></a>00438         
<a name="l00439"></a>00439         pid = <a class="code" href="process_8h.html#ac61b207337ca21b3b309593fd1a0cb82" title="Retrieves the calling process&amp;#39; pid.">getpid</a>();
<a name="l00440"></a>00440         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(pid, <a class="code" href="defs_8h.html#a7ae1ae649327b67ce210e47ea1ed07dc" title="DefineBrief.">ATOMIC</a>);
<a name="l00441"></a>00441         <a class="code" href="schedule_8h.html#a70a005f86f52baf57148ad4074e37f2c" title="This function changes the Algorithm variable, if the current algorithm is RoundRobin...">changeAlgorithimSchedule</a>();
<a name="l00442"></a>00442         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(pid, <a class="code" href="defs_8h.html#a33d80cf420a3739faa00760673eee7db" title="DefineBrief.">UNATOMIC</a>);
<a name="l00443"></a>00443         
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 <span class="comment">/* END SHELL COMMANDS */</span>
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 <span class="keyword">static</span> <a class="code" href="structcommand_t.html" title="The command struct.">commandT</a> * getCommand ( <span class="keywordtype">char</span> * command )
<a name="l00448"></a>00448 {
<a name="l00449"></a>00449         <span class="keywordtype">int</span> i;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451         <span class="keywordflow">for</span> ( i = 0; commands[i].<a class="code" href="structcommand_t.html#aaadded894dece7b4c2b3d51d18ada303">func</a> != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>; ++i )
<a name="l00452"></a>00452                 <span class="keywordflow">if</span> ( <a class="code" href="string_8h.html#a11bd144d7d44914099a3aeddf1c8567d" title="The strcmp() function compares the two strings s1 and s2.">strcmp</a>(commands[i].command, command) == 0 )
<a name="l00453"></a>00453                         <span class="keywordflow">return</span> &amp;(commands[i]);
<a name="l00454"></a>00454         <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>;
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="keyword">static</span> <span class="keywordtype">void</span> printPrompt()
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(prompt);
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 <span class="keyword">static</span> <span class="keywordtype">void</span> parseCommand ( <span class="keywordtype">void</span> )
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464         <a class="code" href="structcommand_t.html" title="The command struct.">commandT</a> * cmd;
<a name="l00465"></a>00465         <span class="keywordtype">char</span> *command, *args;
<a name="l00466"></a>00466         <span class="keywordtype">int</span> indexDT;
<a name="l00467"></a>00467         
<a name="l00468"></a>00468         indexDT = getGlobalDataIndex();
<a name="l00469"></a>00469         <span class="keywordflow">if</span>(indexDT == -1){
<a name="l00470"></a>00470                 <span class="comment">/*EL pid ingresado es invalido,*/</span>
<a name="l00471"></a>00471                 <span class="keywordflow">return</span>;
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473         
<a name="l00474"></a>00474         <a class="code" href="stdio_8h.html#a568f021a83b2c22e1e700d12559d660a" title="putchar function define.">putchar</a>(<span class="charliteral">&#39;\n&#39;</span>);
<a name="l00475"></a>00475         <span class="keywordflow">if</span> ( tableDataShell[indexDT].index == 0 )
<a name="l00476"></a>00476         {
<a name="l00477"></a>00477                 printPrompt();
<a name="l00478"></a>00478                 <span class="keywordflow">return</span>;
<a name="l00479"></a>00479         }
<a name="l00480"></a>00480         tableDataShell[indexDT].<a class="code" href="structdata_slot_shell.html#ae8b496c8abc98d4ba2e5f3d7992c93b7">lineBuffer</a>[tableDataShell[indexDT].<a class="code" href="structdata_slot_shell.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00481"></a>00481         <a class="code" href="string_8h.html#ad80e936d8fe6ed29ad12bb760536ec1d" title="Copies the source Null terminated string to the dst string.">strcpy</a>(tableDataShell[indexDT].enteredCommand, tableDataShell[indexDT].lineBuffer);
<a name="l00482"></a>00482         command = <a class="code" href="string_8h.html#a623f10afaacb826c45536f4191c18357" title="Gets segments of the given string delimitated by the given tokens.">strtok</a>(tableDataShell[indexDT].enteredCommand, <span class="stringliteral">&quot; &quot;</span>);
<a name="l00483"></a>00483         args = <a class="code" href="string_8h.html#a623f10afaacb826c45536f4191c18357" title="Gets segments of the given string delimitated by the given tokens.">strtok</a>(<a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00484"></a>00484         <span class="keywordflow">if</span> ( (cmd = getCommand(command)) != <a class="code" href="defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL pointer definition.">NULL</a> )
<a name="l00485"></a>00485                 cmd-&gt;<a class="code" href="structcommand_t.html#aaadded894dece7b4c2b3d51d18ada303">func</a>(args);
<a name="l00486"></a>00486         <span class="keywordflow">else</span>
<a name="l00487"></a>00487         {
<a name="l00488"></a>00488                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;shell: &quot;</span>);
<a name="l00489"></a>00489                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(tableDataShell[indexDT].lineBuffer);
<a name="l00490"></a>00490                 <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;: Invalid Command\n&quot;</span>);
<a name="l00491"></a>00491         }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493         tableDataShell[indexDT].<a class="code" href="structdata_slot_shell.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0;
<a name="l00494"></a>00494         <span class="keywordflow">if</span> ( tableDataShell[indexDT].status == <a class="code" href="types_8h.html#a94b1da2e055fff4d143aa6aa891f79a9a1061be6c3fb88d32829cba6f6b2be304">RUNNING</a> ) printPrompt();
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a><a class="code" href="shell_8c.html#a225cd0af1ed8359b2973453e2a22a94b">00497</a> <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a225cd0af1ed8359b2973453e2a22a94b" title="The function that runs the shell application.">shell</a> ( <span class="keywordtype">void</span> )
<a name="l00498"></a>00498 {
<a name="l00499"></a>00499         <span class="keywordtype">int</span> c;
<a name="l00500"></a>00500         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> uc;
<a name="l00501"></a>00501         <span class="keywordtype">int</span> indexDT, status;
<a name="l00502"></a>00502         <a class="code" href="types_8h.html#ab612a3a4eb0e2ced1e55ecff76260458" title="pid_t typedef.">pid_t</a> pid;
<a name="l00503"></a>00503         
<a name="l00504"></a>00504         pid = <a class="code" href="process_8h.html#ac61b207337ca21b3b309593fd1a0cb82" title="Retrieves the calling process&amp;#39; pid.">getpid</a>();
<a name="l00505"></a>00505         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(pid, <a class="code" href="defs_8h.html#a7ae1ae649327b67ce210e47ea1ed07dc" title="DefineBrief.">ATOMIC</a>);
<a name="l00506"></a>00506         status = initDataShell();
<a name="l00507"></a>00507         <a class="code" href="process_8h.html#ab5a4ab42ad24ecad7cb6354c4b5f7587" title="Sets the given pid process&amp;#39; atomicity.">setProcessAtomicity</a>(pid, <a class="code" href="defs_8h.html#a33d80cf420a3739faa00760673eee7db" title="DefineBrief.">UNATOMIC</a>);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509         <span class="keywordflow">if</span>(status == <a class="code" href="defs_8h.html#aa93f0eb578d23995850d61f7d61c55c1" title="DefineBrief.">FALSE</a>){
<a name="l00510"></a>00510                 <span class="keywordflow">return</span> -1;
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512         
<a name="l00513"></a>00513         indexDT = getGlobalDataIndex();
<a name="l00514"></a>00514         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;Starting Shell #&quot;</span>);
<a name="l00515"></a>00515         <a class="code" href="stdio_8h.html#a049d7c6dddcd2eafdf1349942dbdac88" title="puti function define.">puti</a>(<a class="code" href="stdio_8h.html#ab7f4e33be6189512770d5aaa43bd03fe">runningProcess</a>-&gt;<a class="code" href="structprocess__t.html#af7f414d19241988592fad1bc470e8761">tty</a> + 1);
<a name="l00516"></a>00516         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;...\n&quot;</span>);
<a name="l00517"></a>00517         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;\tEnter &#39;help&#39; for a list of commands.\n&quot;</span>);
<a name="l00518"></a>00518         <a class="code" href="stdio_8h.html#ab1188d451a7325a10703cbd0f953f31e" title="puts function define.">puts</a>(<span class="stringliteral">&quot;\tEnter &#39;help cmd&#39; for the help message of &#39;cmd&#39;.\n\n&quot;</span>);
<a name="l00519"></a>00519         printPrompt();
<a name="l00520"></a>00520         
<a name="l00521"></a>00521         <span class="keywordflow">while</span> (tableDataShell[indexDT].status == <a class="code" href="types_8h.html#a94b1da2e055fff4d143aa6aa891f79a9a1061be6c3fb88d32829cba6f6b2be304">RUNNING</a>){
<a name="l00522"></a>00522                 c = <a class="code" href="stdio_8h.html#ac0484b3e3a4d8361d91c3322440f9195" title="getchar function define.">getchar</a>();
<a name="l00523"></a>00523                 <span class="keywordflow">if</span> ( c == <a class="code" href="stdio_8h.html#a59adc4c82490d23754cd39c2fb99b0da">EOF</a> ){
<a name="l00524"></a>00524                         <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;hlt&quot;</span>);
<a name="l00525"></a>00525                         <a class="code" href="sys_process_8h.html#a2cd7c071907edcb9f8151c8519d4b27e" title="Blocks the calling process until it&amp;#39;s tty is signaled.">waitTty</a>(<a class="code" href="process_8h.html#a109666f73149f2d6bbead68763749fbd" title="Retrieves the given process pid&amp;#39;s tty.">getTty</a>(pid));
<a name="l00526"></a>00526                         <span class="keywordflow">continue</span>;
<a name="l00527"></a>00527                 }
<a name="l00528"></a>00528                 uc = c;
<a name="l00529"></a>00529                 <span class="keywordflow">if</span> ( uc == <span class="charliteral">&#39;\n&#39;</span> ){
<a name="l00530"></a>00530                         parseCommand();
<a name="l00531"></a>00531                 }
<a name="l00532"></a>00532                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( tableDataShell[indexDT].index &lt; <a class="code" href="config_8h.html#a842ed03f27719bc87666bfd1f75415b8" title="The length of the shell buffer.">MAX_LINE</a>  - 1){
<a name="l00533"></a>00533                         tableDataShell[indexDT].<a class="code" href="structdata_slot_shell.html#ae8b496c8abc98d4ba2e5f3d7992c93b7">lineBuffer</a>[tableDataShell[indexDT].<a class="code" href="structdata_slot_shell.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++] = uc;
<a name="l00534"></a>00534                 }
<a name="l00535"></a>00535         }
<a name="l00536"></a>00536         
<a name="l00537"></a>00537         <span class="keywordflow">return</span> tableDataShell[indexDT].<a class="code" href="structdata_slot_shell.html#a6e27f49150e9a14580fb313cc2777e00">status</a>;
<a name="l00538"></a>00538 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue May 18 16:22:41 2010 for flying-high by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
